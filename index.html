<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>MeFan - Left & Right Containers + One Merged</title>
  <style>
    /* ========== 基础重置 ========== */
    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: sans-serif;
      line-height: 1.6;
      background: #fff;
      color: #333;
      padding-top: 60px; /* 模拟顶部导航高度 */
    }

    .header {
      position: fixed; top: 0; left: 0; width: 100%; height: 60px;
      background: linear-gradient(to right, #DEEFFF, #B2D8FF);
      display: flex; align-items: center; padding: 0 20px;
      z-index: 3000;
    }
    .header h1 {
      font-size: 1.2rem; color: #444;
    }

    /* ========== 模拟轮播容器 ========== */
    .carousel-container {
      position: relative;
      width: 80%; max-width: 1000px;
      margin: 60px auto; padding: 20px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      text-align: center;
    }
    .carousel {
      width: 100%; height: 300px; background: #eee;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem; color: #666;
    }

    /* ========== 父容器：绝对定位到轮播容器中间 ========== */
    .btn-parent {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
      width: 220px; /* 留足宽度给左+右+中缝 */
      height: 80px;
      pointer-events: none; /* 初始不可点击 */
      z-index: 9999;
    }
    .btn-parent.active {
      pointer-events: auto; /* 激活后可点 */
    }

    /* ========== 合并态：一个大圆 ========== */
    .btn-merged {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      border: 2px solid #007aff;
      border-radius: 50%;
      background: #f2f2f2;
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem; color: #333; font-weight: bold;
      opacity: 1; /* 初始可见 */
      transition: opacity 0.3s ease;
    }

    /* ========== 分裂态：左、右容器各自完全独立 ========== */
    /* 让左右物理上分开，中间留间隙 20px (可改) */
    .btn-left {
      position: absolute;
      top: 0; left: 0;
      width: 140px; height: 80px; /* 占父容器左边 140px */
      opacity: 0;
      display: flex; align-items: center; justify-content: center;
    }
    /* 胶囊(进度条+圆点)本身可再加 container */
    .left-pill {
      border: 2px solid #007aff;
      border-radius: 30px;
      background: #f2f2f2;
      display: flex; align-items: center; justify-content: space-evenly;
      gap: 6px;
      padding: 0 12px;
    }
    .progress-bar {
      width: 40px; height: 8px; background: #666; border-radius: 4px;
    }
    .dot {
      width: 6px; height: 6px; background: #666; border-radius: 50%;
    }

    .btn-right {
      position: absolute;
      top: 0; right: 0;
      width: 60px; height: 80px; /* 剩余 60px */
      opacity: 0;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
    }
    /* 播放圆 */
    .right-circle {
      width: 50px; height: 50px; /* 可调 */
      border: 2px solid #007aff;
      border-radius: 50%;
      background: #fff;
      display: flex; align-items: center; justify-content: center;
    }
    .play-icon {
      width: 0; height: 0;
      border-top: 6px solid transparent;
      border-bottom: 6px solid transparent;
      border-left: 10px solid #333;
      margin-left: 2px;
    }

    /* ========== 动画关键帧 (容器进场/离场) ========== */
    @keyframes parentEnter {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
      50% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      100% {
        /* 最终让其位移下移 150px 表示贴近底部 */
        transform: translate(-50%, calc(-50% + 150px)) scale(1);
        opacity: 1;
      }
    }
    @keyframes parentLeave {
      0% {
        transform: translate(-50%, calc(-50% + 150px)) scale(1);
        opacity: 1;
      }
      50% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
    }

    /* ========== 合并态(大圆)动画 ========== */
    @keyframes mergedFadeOut {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }
    @keyframes mergedFadeIn {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }

    /* ========== 分裂态(左右容器)进场/离场 ========== */
    @keyframes leftEnter {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes rightEnter {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes leftLeave {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }
    @keyframes rightLeave {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }

    /* 容器 进场/离场 */
    .btn-parent.enter {
      animation: parentEnter 1.2s forwards ease-in-out;
    }
    .btn-parent.leave {
      animation: parentLeave 1.2s forwards ease-in-out;
    }

    /* 合并态 大圆 */
    .btn-merged.enter {
      animation: mergedFadeOut 0.5s 0.5s forwards ease-in-out;
      /* 0.5s后开始fadeOut, total ~1.0s => 跟 parentEnter配合 */
    }
    .btn-merged.leave {
      animation: mergedFadeIn 0.5s 0.6s forwards ease-in-out;
      /* 在左右都隐藏后(0.6s)再出现(合并态) */
    }

    /* 左胶囊,右圆 进场(分裂) */
    .btn-left.enter {
      animation: leftEnter 0.5s 1.0s forwards ease-in-out;
      /* 1.0s时fadeIn => 大圆差不多fadeOut完毕 */
    }
    .btn-right.enter {
      animation: rightEnter 0.5s 1.0s forwards ease-in-out;
    }
    /* 左胶囊,右圆 离场 */
    .btn-left.leave {
      animation: leftLeave 0.4s 0s forwards ease-in-out;
    }
    .btn-right.leave {
      animation: rightLeave 0.4s 0s forwards ease-in-out;
    }

  </style>
</head>
<body>
  <div class="header">
    <h1>Top Header</h1>
  </div>

  <!-- 模拟长页面让你滚动 -->
  <div style="height:400px; background:#fff;">
    <p style="padding:20px;">Scroll down to see the "carousel-container" and the splitting button demo ...</p>
  </div>

  <!-- 轮播容器 (示例) -->
  <div class="carousel-container" id="carouselContainer">
    <h2>Carousel Demo</h2>
    <div class="carousel">
      <p>Slide Content</p>
    </div>
    <!-- 父容器: 独立3个子容器(合并态/左胶囊/右圆) -->
    <div class="btn-parent" id="btnParent">
      <!-- 合并态大圆 -->
      <div class="btn-merged" id="btnMerged">
        <span>合并态</span>
      </div>
      <!-- 左侧容器: 内含一个胶囊 -->
      <div class="btn-left" id="btnLeft">
        <div class="left-pill">
          <div class="progress-bar"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>
      <!-- 右侧容器: 内含一个圆形播放按钮 -->
      <div class="btn-right" id="btnRight">
        <div class="right-circle">
          <div class="play-icon"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 其余内容... -->
  <div style="height:800px;background:#fafafa; padding:20px;">
    <h2>More content ...</h2>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function(){
    const carouselContainer = document.getElementById('carouselContainer');
    const btnParent = document.getElementById('btnParent');
    const btnMerged = document.getElementById('btnMerged');
    const btnLeft   = document.getElementById('btnLeft');
    const btnRight  = document.getElementById('btnRight');

    let isActive = false; // 是否已出现(分裂态)

    // 给各容器加点击事件测试
    btnMerged.addEventListener('click', (e)=>{
      e.stopPropagation();
      alert("点击合并态大圆！");
    });
    btnLeft.addEventListener('click', (e)=>{
      e.stopPropagation();
      alert("点击左胶囊容器！");
    });
    btnRight.addEventListener('click', (e)=>{
      e.stopPropagation();
      alert("点击右播放圆容器！");
    });

    // 滚动监听
    window.addEventListener('scroll', onScroll);
    function onScroll(){
      const rect = carouselContainer.getBoundingClientRect();
      const distance = rect.bottom - window.innerHeight;
      // 当轮播底部 <= -180 => 显示按钮
      if(distance <= -180 && distance > -2000){
        if(!isActive) showBtn();
      } else {
        if(isActive) hideBtn();
      }
    }

    function showBtn(){
      isActive = true;
      btnParent.classList.add('active'); // pointer-events
      btnParent.classList.remove('leave');
      btnParent.classList.add('enter');

      btnMerged.classList.remove('leave');
      btnMerged.classList.add('enter');

      btnLeft.classList.remove('leave');
      btnLeft.classList.add('enter');

      btnRight.classList.remove('leave');
      btnRight.classList.add('enter');
    }

    function hideBtn(){
      isActive = false;
      btnParent.classList.remove('enter');
      btnParent.classList.add('leave');

      btnMerged.classList.remove('enter');
      btnMerged.classList.add('leave');

      btnLeft.classList.remove('enter');
      btnLeft.classList.add('leave');

      btnRight.classList.remove('enter');
      btnRight.classList.add('leave');
    }
  });
  </script>
</body>
</html>
