<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Carousel with Alpha Shift</title>
  <link rel="stylesheet" href="styles.css">
  <script src="scripts.js" defer></script>
  <script src="scroll.js" defer></script> <!-- 引入优化的滚动脚本 -->
  <style>
    /* ========== 全局基础样式 ========== */
    body {
      margin: 0; padding: 0;
      background: #f0f0f0;
      font-family: Arial, sans-serif;
    }
    h2 { text-align: center; margin: 20px 0; }

    /* ========== 桌面端样式 ========== */
    .demo1-carousel-container {
      position: relative;
      width: 100%;
      height: 495px;         /* 固定高度 */
      margin: auto;
      padding: 0 10%;        /* 桌面端左右留白10% */
      box-sizing: border-box;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .demo1-carousel-track {
      display: flex;
      gap: 15px;             /* 幻灯片之间 15px 间距 */
      transition: transform 0.5s ease-in-out;
      align-items: center;
    }
    .demo1-carousel-slide {
      flex: 0 0 auto;
      width: 100%;          /* 脚本会将 slideWidth 视为 0.8 * containerWidth */
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative; /* 若用 ::before 需要父级 position: relative */原没有触发去阴影
    }
    .demo1-carousel-slide img {
      width: 100%;
      height: auto;         /* 桌面端保持原比例 */
      border-radius: 10px;
      display: block;
    }
    .demo1-carousel-slide.shadow {
  /* 简单做法：让其整体变暗 */
  filter: brightness(0.6);
  transition: filter 0.3s;
}

/* 或者用半透明遮罩 (叠加在slide上) */
.demo1-carousel-slide.shadow::before {
  content: "";
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.2);
  pointer-events: none;
}
 /* ====== 覆盖层(桌面端) ====== */
    .demo1-overlay {
      position: absolute;
      left: 30px;  /* 桌面端：示例性地左上 */
      bottom: 60px;
      color: #fff;
      opacity: 0; /* 初始隐藏，active时显示 */
      white-space: nowrap; 
       display: inline-block; /* 建议配合 inline-block，效果更可控 */
        transform: translateY(50px); /* 初始位置在下方 */
  transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.8s ease-in-out;
    }
    /* 轮播激活时再让覆盖层显示 */
.demo1-carousel-slide.active .demo1-overlay {
  opacity: 1;
  transform: translateY(0); /* 复位 */
}

    .demo1-text-top {
      font-size: 1.1rem;
      margin-bottom: 10px;
      background: rgba(0,0,0,0.5);
      display: inline-block;
      padding: 5px 10px;
      border-radius: 4px;
    }
    .demo1-title {
      font-size: 3rem;
      font-weight: bold;
      margin-bottom:320px;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.5);
      transform: translateY(10px); */
        color: white;
white-space: nowrap; /* 禁止自动换行 */
  display: inline-block; /* 建议配合 inline-block，效果更可控 */
overflow: visible;
      overflow: visible;
  /* 动画或渐入逻辑，如初始下移、active 时上移 */
  opacity: 0;
  transform: translateY(40px);
  transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease-in-out;
  z-index: 999;
    }
    .demo1-carousel-slide.active .demo1-title {
  opacity: 1;
  transform: translateY(0);
  transition-delay: 0.4s; /* 按钮比文字慢 0.4s */
   }
    .demo1-explore-btn {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      background-color: #007BFF;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
   z-index: 999;
opacity: 0;
  transform: translateY(60px); /* 初始往下偏移 60px */
  transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.8s ease-in-out;
       position: absolute;
}
    /* 按钮渐入 */
.demo1-carousel-slide.active .demo1-explore-btn {
  opacity: 1;
  transform: translateY(0);
  transition-delay: 0.4s; /* 按钮比文字慢 0.4s */
}
    .demo1-explore-btn:hover {
  background-color: #0056b3;
}
    .demo1-text-bottom {
      font-size: 1rem;
      margin-top: 10px;
      background: rgba(0,0,0,0.5);
      display: inline-block;
      padding: 5px 10px;
      border-radius: 4px;
        flex-direction: column;
  align-items: flex-start;
      opacity: 1;
        transform: translateY(40px);
  transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease-in-out;
  z-index: 1000;
    }
  /* 文字渐入 */
.demo1-carousel-slide.active .demo1-text-top,
.demo1-carousel-slide.active .demo1-text-bottom {
  opacity: 1;
  transform: translateY(0);
  transition-delay: 0.2s; /* 文字比整体动画稍微慢 0.2s */
}


    /* 小圆点容器：桌面端放在容器外 */
    .demo1-carousel-dots-container {
      text-align: center;
      margin-top: 10px;
    }
    .demo1-carousel-dot {
      width: 10px; height: 10px; background: #ccc;
      border-radius: 50%; margin: 0 5px; display: inline-block;
      cursor: pointer;
    }
    
.demo1-carousel-dot.active {
  background: #007BFF;
}

/* ========== 轮播按钮 ========== */
    .demo1-carousel-prev, .demo1-carousel-next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 30px;
      color: white;
      border: none;
      background: none;
      cursor: pointer;
      z-index: 100;
      display: none; /* 默认隐藏，手机端显示 */
    }
    .demo1-carousel-prev { left: 10px; }
    .demo1-carousel-next { right: 10px; }
/* For PC: Hide the previous/next buttons */
@media (min-width: 1024px) {
    .demo1-carousel-prev,
    .demo1-carousel-next {
        display: none; /* Hide on large screens */
    }

    .demo1-carousel-dots {
        display: block; /* Ensure the dots are visible on larger screens */
        text-align: center;
        margin-top: 15px;
    }

    .demo1-carousel-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        background: #ccc;
        border-radius: 50%;
        margin: 0 5px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .demo1-carousel-dot.active {
        background: #007BFF;
    }
}
    /* ========== 移动端适配 ========== */
@media (max-width: 768px) {
  .demo1-carousel-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 85%; /* 手机端宽度减少 15% */
    min-height: 495px;
    height: 495px;
    margin-top: 12px;
    padding-bottom: 45px; /* 适当增加底部空间，以适应小圆点 */
  }

  .demo1-carousel-track {
    display: flex;
    flex-direction: column;
    gap: 15px; /* 图片之间的间隔 */
    align-items: center;
    width: 100%;
    height: 495px;
  }

  .demo1-carousel-slide {
    width: 100%;
    min-height: 495px;
    max-height: 495px;
    height: 495px; /* 彻底固定高度 */
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  .demo1-carousel-slide img {
    width: 100%;
    min-width: 100%;
    min-height: 495px;
    height: 495px; /* 强制固定高度 */
    object-fit: cover; /* 确保填充，不拉伸 */
    border-radius: 10px;
    display: block; /* 避免 inline 属性影响高度 */
  }

 
.demo1-carousel-prev, .demo1-carousel-next {
        display: block;
      }

 

      .demo1-carousel-dots-container {
        position: absolute;
        left: 0; right: 0; bottom: 10px;
        margin: 0; z-index: 99;
        display: flex; justify-content: center; align-items: center;
      }
      .demo1-carousel-dot {
        width: 8px; height: 8px; margin: 0 4px;
      }
    }
  </style>
</head>
<body>
  <h2>Carousel with Alpha Shift</h2>

<!-- 轮播容器 -->
<div class="demo1-carousel-container">
  
  <!-- 左侧按钮 -->
  <button class="demo1-carousel-prev">&lt;</button>

  <div class="demo1-carousel-track">
    <!-- 幻灯片1 -->
    <div class="demo1-carousel-slide">
      <a href="example.html">
        <img src="Lv-Se-qing-cai.png" alt="Slide1">
      </a>
      <div class="demo1-overlay">
        <div class="demo1-title">小颗青菜</div>
        <button class="demo1-explore-btn">Explore now</button>
        <div class="demo1-text-bottom">Sci-Fi · New season.</div>
      </div>
    </div>
    <!-- 幻灯片2 -->
    <div class="demo1-carousel-slide">
      <a href="example.html">
        <img src="Two baskets of vegetables.png" alt="Slide2">
      </a>
      <div class="demo1-overlay">
        <div class="demo1-title">青菜</div>
        <button class="demo1-explore-btn">Explore now</button>
        <div class="demo1-text-bottom">Sci-Fi · New season.</div>
      </div>
    </div>
    <!-- 幻灯片3 -->
    <div class="demo1-carousel-slide">
      <a href="example.html">
        <img src="A full-body portrait wearing a stylish summer work uniform.png" alt="Slide3">
      </a>
      <div class="demo1-overlay">
        <div class="demo1-title">红菜苔</div>
        <button class="demo1-explore-btn">Explore now</button>
        <div class="demo1-text-bottom">Sci-Fi · New season.</div>
      </div>
    </div>
    <!-- 幻灯片4 -->
    <div class="demo1-carousel-slide">
      <a href="example.html">
        <img src="Di cai hua.png" alt="Slide4">
      </a>
      <div class="demo1-overlay">
        <div class="demo1-title">地菜花</div>
        <button class="demo1-explore-btn">Explore now</button>
        <div class="demo1-text-bottom">Sci-Fi · New season.</div>
      </div>
    </div>
  </div>

  <!-- 右侧按钮 -->
  <button class="demo1-carousel-next">&gt;</button>

</div>

<!-- 小圆点容器(4个) -->
<div class="demo1-carousel-dots-container">
  <span class="demo1-carousel-dot"></span>
  <span class="demo1-carousel-dot"></span>
  <span class="demo1-carousel-dot"></span>
  <span class="demo1-carousel-dot"></span>
</div>


<script>
(function() {
  function initdemo1CarouselTrack() {
    const container = document.querySelector(".demo1-carousel-container");
    const track     = document.querySelector(".demo1-carousel-track");
    let slides      = Array.from(track?.children || []);
    const prevBtn   = document.querySelector(".demo1-carousel-prev");
    const nextBtn   = document.querySelector(".demo1-carousel-next");
    const dots      = Array.from(document.querySelectorAll(".demo1-carousel-dot"));

    if (!container || !track || slides.length === 0 || !dots.length) {
      console.warn("Carousel elements not found!");
      return;
    }

    // 假设真实幻灯片数量
    const totalReal = slides.length;
    let currentIndex = 1; // 初始指向1(后续克隆后)
    let isAnimating = false;
    let autoInterval = null;

    // ============= 1) 克隆首尾实现无缝循环 =============
    const firstClone = slides[0].cloneNode(true);
    const lastClone  = slides[totalReal - 1].cloneNode(true);
    track.appendChild(firstClone);
    track.insertBefore(lastClone, track.firstChild);

    // 更新slides数组(含克隆)
    slides = Array.from(track.children);
    const totalSlidesWithClones = slides.length; // = totalReal + 2

    // ============= 2) 计算宽度(手机端 vs 桌面端) =============
    function getSlideWidth() {
      if (window.innerWidth <= 768) {
        // 手机端
        return Math.floor(window.innerWidth * 0.85) + 15;
      } else {
        // 桌面端
        const refSlide = slides[1];
        let measured = refSlide ? refSlide.getBoundingClientRect().width : 0;
        if (measured === 0) measured = container.clientWidth || window.innerWidth;
        return measured + 15;
      }
    }
    let slideWidth = getSlideWidth();

    // ============= 3) 核心更新函数 =============
    function updateCarousel(useTransition = true) {
      track.style.transition = useTransition ? "transform 0.5s ease-in-out" : "none";
      track.style.transform  = `translateX(${-currentIndex * slideWidth}px)`;

      // 更新 dots
      let dotIndex;
      if (currentIndex === 0) {
        dotIndex = totalReal - 1;
      } else if (currentIndex === totalSlidesWithClones - 1) {
        dotIndex = 0;
      } else {
        dotIndex = currentIndex - 1;
      }
      dots.forEach((dot, i) => {
        dot.classList.toggle("active", i === dotIndex);
      });

      // 移除所有 active/prev/next/shadow
      slides.forEach(sl => {
        sl.classList.remove("active","prev","next","shadow");
        // 禁用内部 <a>
        const aTag = sl.querySelector("a");
        if (aTag) aTag.style.pointerEvents = "none";
      });

      // 中间图 => .active & a可点
      slides[currentIndex].classList.add("active");
      const centerA = slides[currentIndex].querySelector("a");
      if (centerA) centerA.style.pointerEvents = "auto";

      // 左右 => .prev / .next
      const nextIndex = (currentIndex + 1) % totalSlidesWithClones;
      const prevIndex = (currentIndex - 1 + totalSlidesWithClones) % totalSlidesWithClones;
      slides[nextIndex].classList.add("next");
      slides[prevIndex].classList.add("prev");

      // ★只有当前幻灯片不加阴影，其它都加
      slides.forEach((slide, idx) => {
        if (!slide.classList.contains("active")) {
          slide.classList.add("shadow");
        }
      });
    }

    // ============= 4) 统一用户操作: handleUserAction(direction) =============
    function handleUserAction(direction) {
      if (isAnimating) return;
      isAnimating = true;
      if (direction === 'next') {
        currentIndex++;
      } else if (direction === 'prev') {
        currentIndex--;
      } else if (typeof direction === 'number') {
        // 若是小圆点 => dotIndex
        currentIndex = direction + 1; 
      }
      updateCarousel(true);
      resetInterval(); // 重置自动轮播
    }

    // ============= 5) 自动轮播, Interval 重置 =============
    function resetInterval() {
      clearInterval(autoInterval);
      autoInterval = setInterval(() => handleUserAction('next'), 5000);
    }
    autoInterval = setInterval(() => handleUserAction('next'), 5000);

    // ============= 6) 初始化 =============
    track.style.transition = "none";
    updateCarousel(false);
    setTimeout(() => {
      track.style.transition = "transform 0.5s ease-in-out";
    }, 50);

    // ============= 7) transitionend => 无缝循环修正 =============
    track.addEventListener("transitionend", () => {
      if (currentIndex === totalSlidesWithClones - 1) {
        // 最后克隆 => 立刻跳回真实第一张
        track.style.transition = "none";
        currentIndex = 1;
        updateCarousel(false);
      } else if (currentIndex === 0) {
        // 最前克隆 => 跳回真实最后一张
        track.style.transition = "none";
        currentIndex = totalReal;
        updateCarousel(false);
      }
      isAnimating = false;
    });

    // ============= 8) 左右按钮 / dots =============
    // 左按钮 => handleUserAction('prev')
    prevBtn?.addEventListener("click", () => handleUserAction('prev'));
    // 右按钮 => handleUserAction('next')
    nextBtn?.addEventListener("click", () => handleUserAction('next'));
    // 小圆点 => handleUserAction(dotIndex)
    dots.forEach((dot, i) => {
      dot.addEventListener("click", () => handleUserAction(i));
    });

    // ============= 9) 点击事件: 中图 => 链接, 左右图 => 切换 =============
    slides.forEach(sl => {
      sl.addEventListener("click", (e) => {
        if (sl.classList.contains("active")) {
          // 中图 => 不阻止 => 允许 <a>
        } else if (sl.classList.contains("next")) {
          e.preventDefault();
          handleUserAction('next');
        } else if (sl.classList.contains("prev")) {
          e.preventDefault();
          handleUserAction('prev');
        }
      });
    });

    // Explore now
    const exploreBtns = document.querySelectorAll(".demo1-explore-btn");
    exploreBtns.forEach(btn => {
      btn.addEventListener("click", (e) => {
        const link = e.target.closest(".demo1-carousel-slide")?.querySelector("a");
        if (link) {
          window.location.href = link.href;
        }
      });
    });

    // ============= 10) 手机端手指滑动 => unify with handleUserAction =============
    let startX = 0;
    let isSwiping = false;
    container.addEventListener('touchstart', (e) => {
      if (isAnimating) return;
      isSwiping = true;
      startX = e.touches[0].clientX;
    });
    container.addEventListener('touchend', (e) => {
      if (!isSwiping) return;
      isSwiping = false;
      const endX = e.changedTouches[0].clientX;
      const distance = endX - startX;
      if (Math.abs(distance) > 50) {
        if (distance < 0) {
          // 向左滑 => next
          handleUserAction('next');
        } else {
          // 向右滑 => prev
          handleUserAction('prev');
        }
      }
    });
    // 不做touchmove拖拽

    // ============= 11) 监听窗口大小 => 重算 slideWidth =============
    window.addEventListener("resize", () => {
      isAnimating = false;
      track.style.transition = "none";
      slideWidth = getSlideWidth();
      updateCarousel(false);
      setTimeout(() => {
        track.style.transition = "transform 0.5s ease-in-out";
      }, 50);
    });

    // ============= 12) 按钮可选显示(手机端 vs 桌面端) =============
    if (window.innerWidth <= 768) {
      if (prevBtn) prevBtn.style.display = "block";
      if (nextBtn) nextBtn.style.display = "block";
    } else {
      if (prevBtn) prevBtn.style.display = "none";
      if (nextBtn) nextBtn.style.display = "none";
    }
  }

  // 在window.onload后执行
  window.addEventListener('load', initdemo1CarouselTrack);
})();









</script>
</body>
</html>
