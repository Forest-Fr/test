<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Carousel with Alpha Shift</title>
  <link rel="stylesheet" href="styles.css">
  <script src="scripts.js" defer></script>
  <script src="scroll.js" defer></script> <!-- 引入优化的滚动脚本 -->
  <style>
    /* ========== 全局基础样式 ========== */
    body {
      margin: 0; padding: 0;
      background: #f0f0f0;
      font-family: Arial, sans-serif;
    }
    h2 { text-align: center; margin: 20px 0; }

    /* ========== 桌面端样式 ========== */
    .demo1-carousel-container {
      position: relative;
      width: 100%;
      height: 495px;         /* 固定高度 */
      margin: auto;
      padding: 0 10%;        /* 桌面端左右留白10% */
      box-sizing: border-box;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .demo1-carousel-track {
      display: flex;
      gap: 15px;             /* 幻灯片之间 15px 间距 */
      transition: transform 0.5s ease-in-out;
      align-items: center;
    }
    .demo1-carousel-slide {
      flex: 0 0 auto;
      width: 100%;          /* 脚本会将 slideWidth 视为 0.8 * containerWidth */
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative; /* 若用 ::before 需要父级 position: relative */原没有触发去阴影
    }
    .demo1-carousel-slide img {
      width: 100%;
      height: auto;         /* 桌面端保持原比例 */
      border-radius: 10px;
      display: block;
    }
    .demo1-carousel-slide.shadow {
  /* 简单做法：让其整体变暗 */
  filter: brightness(0.6);
  transition: filter 0.3s;
}

/* 或者用半透明遮罩 (叠加在slide上) */
.demo1-carousel-slide.shadow::before {
  content: "";
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.2);
  pointer-events: none;
}
 /* ====== 覆盖层(桌面端) ====== */
    .demo1-overlay {
      position: absolute;
      left: 30px;  /* 桌面端：示例性地左上 */
      bottom: 60px;
      color: #fff;
      opacity: 0; /* 初始隐藏，active时显示 */
      white-space: nowrap; 
       display: inline-block; /* 建议配合 inline-block，效果更可控 */
        transform: translateY(50px); /* 初始位置在下方 */
  transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.8s ease-in-out;
    }
    /* 轮播激活时再让覆盖层显示 */
.demo1-carousel-slide.active .demo1-overlay {
  opacity: 1;
  transform: translateY(0); /* 复位 */
}

    .demo1-text-top {
      font-size: 1.1rem;
      margin-bottom: 10px;
      background: rgba(0,0,0,0.5);
      display: inline-block;
      padding: 5px 10px;
      border-radius: 4px;
    }
    .demo1-title {
      font-size: 3rem;
      font-weight: bold;
      margin-bottom:320px;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.5);
      transform: translateY(10px); */
        color: white;
white-space: nowrap; /* 禁止自动换行 */
  display: inline-block; /* 建议配合 inline-block，效果更可控 */
overflow: visible;
      overflow: visible;
  /* 动画或渐入逻辑，如初始下移、active 时上移 */
  opacity: 0;
  transform: translateY(40px);
  transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease-in-out;
  z-index: 999;
    }
    .demo1-carousel-slide.active .demo1-title {
  opacity: 1;
  transform: translateY(0);
  transition-delay: 0.4s; /* 按钮比文字慢 0.4s */
   }
    .demo1-explore-btn {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      background-color: #007BFF;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
   z-index: 999;
opacity: 0;
  transform: translateY(60px); /* 初始往下偏移 60px */
  transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.8s ease-in-out;
       position: absolute;
}
    /* 按钮渐入 */
.demo1-carousel-slide.active .demo1-explore-btn {
  opacity: 1;
  transform: translateY(0);
  transition-delay: 0.4s; /* 按钮比文字慢 0.4s */
}
    .demo1-explore-btn:hover {
  background-color: #0056b3;
}
    .demo1-text-bottom {
      font-size: 1rem;
      margin-top: 10px;
      background: rgba(0,0,0,0.5);
      display: inline-block;
      padding: 5px 10px;
      border-radius: 4px;
        flex-direction: column;
  align-items: flex-start;
      opacity: 1;
        transform: translateY(40px);
  transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease-in-out;
  z-index: 1000;
    }
  /* 文字渐入 */
.demo1-carousel-slide.active .demo1-text-top,
.demo1-carousel-slide.active .demo1-text-bottom {
  opacity: 1;
  transform: translateY(0);
  transition-delay: 0.2s; /* 文字比整体动画稍微慢 0.2s */
}


    /* 小圆点容器：桌面端放在容器外 */
    .demo1-carousel-dots-container {
      text-align: center;
      margin-top: 10px;
    }
    .demo1-carousel-dot {
      width: 10px; height: 10px; background: #ccc;
      border-radius: 50%; margin: 0 5px; display: inline-block;
      cursor: pointer;
    }
    
.demo1-carousel-dot.active {
  background: #007BFF;
}

/* ========== 轮播按钮 ========== */
    .demo1-carousel-prev, .demo1-carousel-next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 30px;
      color: white;
      border: none;
      background: none;
      cursor: pointer;
      z-index: 100;
      display: none; /* 默认隐藏，手机端显示 */
    }
    .demo1-carousel-prev { left: 10px; }
    .demo1-carousel-next { right: 10px; }
/* For PC: Hide the previous/next buttons */
@media (min-width: 1024px) {
    .demo1-carousel-prev,
    .demo1-carousel-next {
        display: none; /* Hide on large screens */
    }

    .demo1-carousel-dots {
        display: block; /* Ensure the dots are visible on larger screens */
        text-align: center;
        margin-top: 15px;
    }

    .demo1-carousel-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        background: #ccc;
        border-radius: 50%;
        margin: 0 5px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .demo1-carousel-dot.active {
        background: #007BFF;
    }
}
    /* ========== 移动端适配 ========== */
@media (max-width: 768px) {
  .demo1-carousel-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 85%; /* 手机端宽度减少 15% */
    min-height: 495px;
    height: 495px;
    margin-top: 12px;
    padding-bottom: 45px; /* 适当增加底部空间，以适应小圆点 */
  }

  .demo1-carousel-track {
    display: flex;
    flex-direction: column;
    gap: 15px; /* 图片之间的间隔 */
    align-items: center;
    width: 100%;
    height: 495px;
  }

  .demo1-carousel-slide {
    width: 100%;
    min-height: 495px;
    max-height: 495px;
    height: 495px; /* 彻底固定高度 */
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  .demo1-carousel-slide img {
    width: 100%;
    min-width: 100%;
    min-height: 495px;
    height: 495px; /* 强制固定高度 */
    object-fit: cover; /* 确保填充，不拉伸 */
    border-radius: 10px;
    display: block; /* 避免 inline 属性影响高度 */
  }

 
.demo1-carousel-prev, .demo1-carousel-next {
        display: block;
      }

 

      .demo1-carousel-dots-container {
        position: absolute;
        left: 0; right: 0; bottom: 10px;
        margin: 0; z-index: 99;
        display: flex; justify-content: center; align-items: center;
      }
      .demo1-carousel-dot {
        width: 8px; height: 8px; margin: 0 4px;
      }
    }
  </style>
</head>
<body>
  <h2>Carousel with Alpha Shift</h2>

<!-- 轮播容器 -->
<div class="demo1-carousel-container">
  
  <!-- 左侧按钮 -->
  <button class="demo1-carousel-prev">&lt;</button>

  <div class="demo1-carousel-track">
    <!-- 幻灯片1 -->
    <div class="demo1-carousel-slide">
      <a href="example.html">
        <img src="Lv-Se-qing-cai.png" alt="Slide1">
      </a>
      <div class="demo1-overlay">
        <div class="demo1-title">小颗青菜</div>
        <button class="demo1-explore-btn">Explore now</button>
        <div class="demo1-text-bottom">Sci-Fi · New season.</div>
      </div>
    </div>
    <!-- 幻灯片2 -->
    <div class="demo1-carousel-slide">
      <a href="example.html">
        <img src="Two baskets of vegetables.png" alt="Slide2">
      </a>
      <div class="demo1-overlay">
        <div class="demo1-title">青菜</div>
        <button class="demo1-explore-btn">Explore now</button>
        <div class="demo1-text-bottom">Sci-Fi · New season.</div>
      </div>
    </div>
    <!-- 幻灯片3 -->
    <div class="demo1-carousel-slide">
      <a href="example.html">
        <img src="A full-body portrait wearing a stylish summer work uniform.png" alt="Slide3">
      </a>
      <div class="demo1-overlay">
        <div class="demo1-title">红菜苔</div>
        <button class="demo1-explore-btn">Explore now</button>
        <div class="demo1-text-bottom">Sci-Fi · New season.</div>
      </div>
    </div>
    <!-- 幻灯片4 -->
    <div class="demo1-carousel-slide">
      <a href="example.html">
        <img src="Di cai hua.png" alt="Slide4">
      </a>
      <div class="demo1-overlay">
        <div class="demo1-title">地菜花</div>
        <button class="demo1-explore-btn">Explore now</button>
        <div class="demo1-text-bottom">Sci-Fi · New season.</div>
      </div>
    </div>
  </div>

  <!-- 右侧按钮 -->
  <button class="demo1-carousel-next">&gt;</button>

</div>

<!-- 小圆点容器(4个) -->
<div class="demo1-carousel-dots-container">
  <span class="demo1-carousel-dot"></span>
  <span class="demo1-carousel-dot"></span>
  <span class="demo1-carousel-dot"></span>
  <span class="demo1-carousel-dot"></span>
</div>


<script>
(function () {
  const initdemo1CarouselTrack = () => {
    const container = document.querySelector(".demo1-carousel-container");
    const track = document.querySelector(".demo1-carousel-track");
    let slides = Array.from(document.querySelectorAll(".demo1-carousel-slide"));
    const prevBtn = document.querySelector(".demo1-carousel-prev");
    const nextBtn = document.querySelector(".demo1-carousel-next");
    const dots = Array.from(document.querySelectorAll(".demo1-carousel-dot"));

    if (!container || !track || slides.length === 0 || !dots.length) return;

    const totalReal = slides.length;
    let isAnimating = false;
    let currentIndex = 1; 
    let interval; // 轮播自动播放的定时器

    // 1) 克隆首尾幻灯片
    const firstClone = slides[0].cloneNode(true);
    const lastClone = slides[totalReal - 1].cloneNode(true);
    track.appendChild(firstClone);
    track.insertBefore(lastClone, track.firstChild);

    // 重新获取 slides
    slides = Array.from(track.querySelectorAll(".demo1-carousel-slide"));

    // 2) 根据设备类型执行预加载与初始化
    if (window.innerWidth <= 768) {
      // 手机端：先隐藏轨道，预加载图片后再显示并初始化
      track.style.transition = "none";
      track.style.opacity = "0";
      preloadImages(slides, () => {
        initMobileCarousel();
      });
    } else {
      // 桌面端：直接初始化（保持原逻辑）
      initDesktopCarousel();
    }

    // ========== 公用函数 ==========
    function preloadImages(slideElems, callback) {
      let loadedCount = 0;
      const totalSlides = slideElems.length;
      slideElems.forEach(slide => {
        const img = slide.querySelector("img");
        if (!img) {
          loadedCount++;
          if (loadedCount === totalSlides) callback();
        } else {
          if (img.complete) {
            loadedCount++;
            if (loadedCount === totalSlides) callback();
          } else {
            img.addEventListener("load", () => {
              loadedCount++;
              if (loadedCount === totalSlides) callback();
            });
          }
        }
      });
    }

    function initMobileCarousel() {
      // 计算 slideWidth（含间隔 15px）
      let slideWidth = slides[1].getBoundingClientRect().width + 15;

      // 让真实第一张( slides[1] )居中
      centerFirstSlideOnLoad();

      // 显示轨道
      track.style.opacity = "1";

      // 初始更新一次轮播（无动画）
      updateCarousel(false);

      // 启动过渡动画
      setTimeout(() => {
        track.style.transition = "transform 0.5s ease-in-out";
      }, 50);

      // 启动自动播放
      interval = setInterval(nextSlide, 5000);

      // 显示左右按钮（手机端需要）
      if (prevBtn) prevBtn.style.display = "block";
      if (nextBtn) nextBtn.style.display = "block";
    }

    function initDesktopCarousel() {
      // 桌面端保持原逻辑
      track.style.transition = "none";
      updateCarousel(false);
      setTimeout(() => {
        track.style.transition = "transform 0.5s ease-in-out";
      }, 50);
      interval = setInterval(nextSlide, 5000);
      if (prevBtn) prevBtn.style.display = "none";
      if (nextBtn) nextBtn.style.display = "none";
    }

    // 让“真实第一张”居中（注意：由于克隆，真实第一张在 slides[1]）
    function centerFirstSlideOnLoad() {
      if (!container || !slides[1]) return;
      const slideCenter = slides[1].offsetLeft + slides[1].offsetWidth / 2;
      const containerCenter = container.offsetWidth / 2;
      container.scrollLeft = slideCenter - containerCenter;
    }

    // 更新轮播位置、设置 active/prev/next 及阴影、按钮显隐
    function updateCarousel(animated = true) {
      let slideWidth = slides[1].getBoundingClientRect().width + 15;
      track.style.transition = animated ? "transform 0.5s ease-in-out" : "none";
      track.style.transform = `translateX(${-currentIndex * slideWidth}px)`;

      // 更新小圆点
      let dotIndex = (currentIndex === 0) ? totalReal - 1 : 
                     (currentIndex === slides.length - 1) ? 0 : 
                     currentIndex - 1;
      dots.forEach((dot, i) => dot.classList.toggle("active", i === dotIndex));

      // 清除所有 active/prev/next/shadow
      slides.forEach(sl => sl.classList.remove("active", "prev", "next", "shadow"));

      // 禁用所有 <a> 的点击
      slides.forEach(sl => {
        const aTag = sl.querySelector("a");
        if (aTag) aTag.style.pointerEvents = "none";
      });

      // 设定 active slide
      slides[currentIndex].classList.add("active");
      const centerA = slides[currentIndex].querySelector("a");
      if (centerA) centerA.style.pointerEvents = "auto";

      // 设定 prev / next
      const nextIndex = (currentIndex + 1) % slides.length;
      const prevIndex = (currentIndex - 1 + slides.length) % slides.length;
      slides[nextIndex].classList.add("next");
      slides[prevIndex].classList.add("prev");

      // 给非 active 的 slide 添加阴影
      slides.forEach(slide => {
        if (!slide.classList.contains("active")) {
          slide.classList.add("shadow");
        }
      });

      // 按钮显隐处理：所有按钮隐藏，仅当前 active slide 的按钮显示
      document.querySelectorAll(".demo1-explore-btn").forEach(btn => {
        btn.style.opacity = "0";
        btn.style.pointerEvents = "none";
      });
      const activeBtn = slides[currentIndex].querySelector(".demo1-explore-btn");
      if (activeBtn) {
        activeBtn.style.opacity = "1";
        activeBtn.style.pointerEvents = "auto";
      }
    }

    function nextSlide() {
      if (isAnimating) return;
      isAnimating = true;
      currentIndex++;
      updateCarousel();

      // 桌面端用 setTimeout 重置索引（手机端依赖 transitionend）
      if (window.innerWidth > 768) {
        setTimeout(() => {
          if (currentIndex === slides.length - 1) {
            track.style.transition = "none";
            currentIndex = 1;
            updateCarousel(false);
          }
          isAnimating = false;
        }, 500);
      }
    }

    function prevSlide() {
      if (isAnimating) return;
      isAnimating = true;
      currentIndex--;
      updateCarousel();

      if (window.innerWidth > 768) {
        setTimeout(() => {
          if (currentIndex === 0) {
            track.style.transition = "none";
            currentIndex = totalReal;
            updateCarousel(false);
          }
          isAnimating = false;
        }, 500);
      }
    }

    function jumpToSlide(index) {
      if (isAnimating) return;
      isAnimating = true;
      currentIndex = index + 1;
      updateCarousel();
      setTimeout(() => isAnimating = false, 500);
    }

    // 绑定左右按钮（原始绑定）
    prevBtn?.addEventListener("click", prevSlide);
    nextBtn?.addEventListener("click", nextSlide);

    // 小圆点点击事件
    dots.forEach((dot, index) => dot.addEventListener("click", () => jumpToSlide(index)));

    // 自动播放间隔重置
    function resetInterval() {
      clearInterval(interval);
      interval = setInterval(nextSlide, 5000);
    }

    // transitionend事件：针对手机端无缝无限轮播
    track.addEventListener("transitionend", () => {
      if (window.innerWidth <= 768) {
        if (currentIndex === slides.length - 1) {
          track.style.transition = "none";
          currentIndex = 1;
          updateCarousel(false);
        } else if (currentIndex === 0) {
          track.style.transition = "none";
          currentIndex = totalReal;
          updateCarousel(false);
        }
      }
      isAnimating = false;
    });

    // 点击逻辑：点击非 active 的 slide 触发相应动作
    slides.forEach(slide => {
      slide.addEventListener("click", (e) => {
        if (slide.classList.contains("active")) {
          // 允许 <a> 正常跳转
        } else if (slide.classList.contains("next")) {
          e.preventDefault();
          nextSlide();
          resetInterval();
        } else if (slide.classList.contains("prev")) {
          e.preventDefault();
          prevSlide();
          resetInterval();
        }
      });
    });

    // Explore Now 按钮点击逻辑
    const exploreBtns = document.querySelectorAll('.demo1-explore-btn');
    exploreBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        const link = e.target.closest('.demo1-carousel-slide')?.querySelector('a');
        if (link) {
          window.location.href = link.href;
        }
      });
    });

    // 触摸滑动交互
    let startX = 0;
    let isSwiping = false;

    container.addEventListener('touchstart', (e) => {
      if (isAnimating) return;
      isSwiping = true;
      startX = e.touches[0].clientX;
    });

    container.addEventListener('touchend', (e) => {
      if (!isSwiping) return;
      let endX = e.changedTouches[0].clientX;
      let distance = endX - startX;
      isSwiping = false;
      if (Math.abs(distance) > 50) {
        if (distance < 0) {
          nextSlide();
        } else {
          prevSlide();
        }
        resetInterval();
      }
    });

    // ========== 手机端补丁：修复事件绑定问题 ==========
    if (window.innerWidth <= 768) {
      // 移除可能错误的绑定（如果存在）
      prevBtn?.removeEventListener("click", nextSlide);
      nextBtn?.removeEventListener("click", prevSlide);
      // 重新绑定正确的事件
      prevBtn?.addEventListener("click", prevSlide);
      nextBtn?.addEventListener("click", nextSlide);
    }
  };

  window.addEventListener("load", initdemo1CarouselTrack);
})();









</script>
</body>
</html>
