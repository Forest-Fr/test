<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MeFan - Split Circle Apple-Style</title>
  <style>
    /* ========== Reset & 基础 ========== */
    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #fff;
      color: #333;
      line-height: 1.6;
      padding-top: 40px; /* 主导航高度 */
    }

    /* ========== 原主导航 ========== */
    .header-gradient {
      position: fixed; top: 0; left: 0;
      width: 100%; z-index: 3000;
      padding: 10px 20px;
      display: flex; align-items: center; justify-content: space-between;
      background: linear-gradient(to right, #DEEFFF, #B2D8FF);
      transition: background 0.2s ease, transform 0.3s ease, opacity 0.3s ease;
      height: 60px; /* 统一导航高度 */
    }
    .header-gradient.nav-white { background: #fff !important; }
    .logo-img {
      width: 60px; margin-right: 20px;
    }

    /* ========== 横幅 Banner ========== */
    .banner-promo {
      margin-top: 40px;
      background-color: #EFF7FF;
      border-top: 1px solid #CBD5E1;
      border-bottom: 1px solid #CBD5E1;
      padding: 10px 0;
      text-align: center;
      font-size: 14px;
      color: #333;
    }
    .banner-promo a {
      color: #0071e3;
      text-decoration: none;
      font-weight: 500;
    }
    .banner-promo a:hover {
      text-decoration: underline;
    }

    /* ========== 头图区 ========== */
    .section1-hero {
      position: relative; width: 100%; margin: 0 auto; overflow: hidden; text-align: center;
      background-color: #000;
    }
    .section1-hero-img {
      width: 100%; height: auto;
      max-height: 520px;
      display: block; object-fit: cover;
    }
    .section1-hero-content {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: #fff; text-align: center;
      max-width: 90%;
    }
    .section1-title {
      font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;
    }
    .section1-subtitle {
      font-size: 1.4rem; margin-bottom: 1rem;
    }
    .section1-buy-btn {
      display: inline-block;
      background-color: #0071e3; color: #fff;
      text-decoration: none; padding: 10px 20px;
      border-radius: 4px; font-size: 1rem;
      margin-bottom: 0.8rem;
    }
    .section1-buy-btn:hover { background-color: #005bb5; }
    .section1-price {
      font-size: 0.9rem; margin-top: 0;
    }

    /* ========== 桌面端新导航 (Mefan Air) ========== */
    .mefan-air-wrap {
      position: fixed; top: 0; left: 0; width: 100%;
      z-index: 4000; background: #f8f8f8; border-bottom: 1px solid #ddd;
      padding: 10px 20px; transform: translateY(-100%);
      opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .mefan-air-wrap.active {
      transform: translateY(0); opacity: 1;
    }
    .mefan-air-nav {
      display: flex; align-items: center; justify-content: space-between;
      width: 100%; margin: 0; padding: 0;
    }
    .mefan-air-left {
      font-size: 1.2rem; font-weight: 600; margin-right: auto;
    }
    .mefan-air-list {
      list-style: none; display: flex; gap: 20px; margin: 0;
    }
    .mefan-air-list li a {
      text-decoration: none; color: #0071e3;
    }

    /* ========== 移动端新导航 (Mefan Air) ========== */
    .mobile-air-nav {
      position: fixed; top: 0; left: 0; width: 100%;
      z-index: 5000; display: none;
      background-color: #fff; border-bottom: 1px solid #ddd;
      padding: 10px 20px;
    }
    .mobile-air-nav.active { display: block; }
    .mobile-air-top {
      display: flex; align-items: center; justify-content: space-between;
    }
    .mobile-air-left {
      font-size: 1rem; font-weight: 600;
    }
    .mobile-air-right {
      display: flex; align-items: center; gap: 16px;
    }
    .mobile-air-toggle-btn {
      font-size: 1.2rem; cursor: pointer; user-select: none;
    }
    .mobile-air-buy {
      padding: 6px 12px; background-color: #0071e3; color: #fff;
      text-decoration: none; border-radius: 4px;
    }
    .mobile-air-panel {
      overflow: hidden; width: 70%; max-height: 0; transition: max-height 0.3s ease;
    }
    .mobile-air-panel.active { max-height: 100vh; }
    .mobile-air-panel-list {
      list-style: none; margin: 0; padding: 0;
    }
    .mobile-air-panel-list li { border-bottom: 1px solid #eee; }
    .mobile-air-panel-list li a {
      display: block; padding: 14px 20px;
      text-decoration: none; color: #333;
    }
    .mobile-air-panel-list li a:hover { background-color: #f2f2f2; }
    .mobile-air-blur {
      position: fixed; top: 0; left: 0; width: 100%; height: 0;
      z-index: 4500; background: rgba(0,0,0,0.3); backdrop-filter: blur(8px);
      transition: height 0.3s ease, opacity 0.3s ease;
      opacity: 0;
    }
    .mobile-air-blur.active {
      height: 100vh; opacity: 1;
    }
    @media (min-width: 769px) {
      .mobile-air-nav, .mobile-air-panel, .mobile-air-blur {
        display: none !important;
      }
    }
    @media (max-width: 768px) {
      .mefan-air-wrap { display: none !important; }
    }

    /* ========== 轮播区 (Section2) ========== */
    .section2-highlights {
      margin-top: 50px; padding: 30px 20px;
      text-align: center; position: relative;
    }
    .section2-title {
      font-size: 2.5rem; margin-bottom: 50px;
    }
    .section2-carousel-wrapper {
      width: 100%; max-width: 1013px; overflow: hidden; margin: 0 auto;
    }
    .section2-carousel-inner {
      display: flex; gap: 15px;
      transform: translateX(0); transition: transform 0.6s ease;
    }
    .section2-carousel-item {
      flex: 0 0 1013px; position: relative;
    }
    .section2-carousel-item img {
      width: 100%; display: block;
    }
    .section2-caption {
      position: absolute; top: 20px; left: 20px;
      font-size: 1.5rem; color: #333;
    }
    /* 原有播放+dots+refresh */
    .section2-controls {
      display: flex; justify-content: center; align-items: center;
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.4s ease, transform 0.4s ease;
      margin-top: 20px;
    }
    .section2-controls.active {
      opacity: 1; transform: translateY(0);
    }
    .section2-play-btn {
      font-size: 24px; background: none; border: none; cursor: pointer;
      margin-right: 16px; opacity: 0; transition: opacity 0.4s ease;
    }
    .section2-controls.active .section2-play-btn { opacity: 1; }
    .section2-dots {
      background: #f2f2f2; border-radius: 30px; padding: 8px 16px;
      display: flex; gap: 12px;
    }
    .section2-dot {
      width: 10px; height: 10px; background: #999; border-radius: 50%; cursor: pointer;
      transition: width 5s linear;
    }
    .section2-dot.active {
      width: 40px; background: #333; border-radius: 4px;
    }
    .section2-refresh-btn {
      margin-left: 16px; font-size: 24px; background: none; border: none; cursor: pointer;
    }

    /* ========== 分裂式圆圈按钮 ========== */
    /* 先把外容器放在轮播区“绝对定位” => 初始在容器中央 (top:50%...),
       动画结束后移动到底部30px */
    .split-circle-wrap {
      position: absolute;
      width: 80px; height: 80px;
      pointer-events: none; /* 初始不可点 */
      opacity: 0;           /* 初始透明 */
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      z-index: 9999;        /* 确保在图片上层 */
    }
    .split-circle-wrap.active {
      pointer-events: auto; /* 激活后可点击 */
    }

    /* 外圈+内圈 => 分裂动画 */
    .outer-ring,
    .inner-circle {
      position: absolute; top: 0; left: 0;
      width: 80px; height: 80px;
      border-radius: 50%;
    }
    .outer-ring {
      border: 3px solid #007aff; background: transparent;
    }
    .inner-circle {
      background: #444;
    }

    /* ========== Keyframes for the container's position/scale ========== */
    @keyframes circleContainerEnter {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
      30% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      /* 到60%时仍在中央; 让内圈与外圈内部clip-path分裂 */
      60% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      /* 动画最后移动到底部 30px 处 (本示例假设容器高度~520px, 你可微调) */
      100% {
        /* 这里让 Y 平移到 ~ (containerHeight - 30) - (80/2) = 230px 仅示例 */
        /* 真实项目请微调 translateY( 200px / 300px ) 以贴合实际 */
        transform: translate(-50%, calc( -50% + 200px )) scale(1);
        opacity: 1;
      }
    }
    @keyframes circleContainerLeave {
      0% {
        /* 从底部位置开始 */
        transform: translate(-50%, calc( -50% + 200px )) scale(1);
        opacity: 1;
      }
      40% {
        /* 先回到中央 */
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
    }

    /* ========== Keyframes for the “split” ========== */
    @keyframes circleEnter {
      0%   { transform: scale(0); }
      30%  { transform: scale(1); }
      60%  { clip-path: inset(0 50% 0 0); }
      100% { clip-path: inset(0 50% 0 0); }
    }
    @keyframes circleEnterInner {
      0%   { transform: scale(0); }
      30%  { transform: scale(1); }
      60%  { clip-path: inset(0 0 0 50%); }
      100% { clip-path: inset(0 0 0 50%); }
    }
    @keyframes circleLeave {
      0%   { clip-path: inset(0 50% 0 0); transform: scale(1); }
      40%  { clip-path: inset(0); }
      100% { transform: scale(0); }
    }
    @keyframes circleLeaveInner {
      0%   { clip-path: inset(0 0 0 50%); transform: scale(1); }
      40%  { clip-path: inset(0); }
      100% { transform: scale(0); }
    }

    /* 容器 position 动画: enter / leave */
    .split-circle-wrap.enter {
      animation: circleContainerEnter 1.1s forwards ease-in-out;
    }
    .split-circle-wrap.leave {
      animation: circleContainerLeave 1.1s forwards ease-in-out;
    }
    /* 外圈 & 内圈: clip-path 分裂 / 合并 */
    .outer-ring.enter {
      animation: circleEnter 1.1s forwards ease-in-out;
    }
    .inner-circle.enter {
      animation: circleEnterInner 1.1s forwards ease-in-out;
    }
    .outer-ring.leave {
      animation: circleLeave 1.1s forwards ease-in-out;
    }
    .inner-circle.leave {
      animation: circleLeaveInner 1.1s forwards ease-in-out;
    }
  </style>
</head>
<body>

  <!-- ========== 原主导航等区域，保持不变 ========== -->
  <header class="header-gradient" id="mainHeader">
    <img src="MeFan Logo.png" alt="MeFan Logo" class="logo-img">
    <!-- 其余导航同原代码 -->
  </header>

  <div class="banner-promo">Buy now with special offers! <a href="#">Shop &gt;</a></div>

  <!-- ========== 头图区 ========== -->
  <section class="section1-hero">
    <img src="YourLargeImage.png" alt="MeFan X1" class="section1-hero-img">
    <div class="section1-hero-content">
      <h1 class="section1-title">Experience Next-Gen Sound</h1>
      <h2 class="section1-subtitle">Unleash the power of wireless audio.</h2>
      <a href="#" class="section1-buy-btn">Buy</a>
      <p class="section1-price">From $599 or $49.91/mo. for 12 mo.*</p>
    </div>
  </section>

  <!-- ========== Section2 (轮播) ========== -->
  <section id="section2-highlights" class="section2-highlights">
    <h2 class="section2-title">Highlights</h2>
    <div class="section2-carousel-wrapper">
      <div class="section2-carousel-inner">
        <!-- 轮播项 -->
        <div class="section2-carousel-item" data-index="0">
          <img src="Slide1.png" width="1314" height="520" alt="MeFan Pro">
        </div>
        <div class="section2-carousel-item" data-index="1">
          <img src="Slide2.png" width="1314" height="520" alt="MeFan Lite">
        </div>
        <div class="section2-carousel-item" data-index="2">
          <img src="Slide3.png" width="1314" height="520" alt="Girl wearing headphones">
        </div>
      </div>
    </div>

    <!-- 底部播放+Dots+刷新(原功能) -->
    <div class="section2-controls">
      <button class="section2-play-btn" title="Play">▶</button>
      <div class="section2-dots">
        <span class="section2-dot" data-index="0"></span>
        <span class="section2-dot" data-index="1"></span>
        <span class="section2-dot" data-index="2"></span>
      </div>
      <button class="section2-refresh-btn" title="Restart">&#10227;</button>
    </div>

    <!-- ========== 分裂圆圈外容器 ========== -->
    <div id="splitCircle" class="split-circle-wrap">
      <div class="outer-ring"></div>
      <div class="inner-circle"></div>
    </div>
  </section>

  <!-- 其余内容 (Mefan Air wrap, mobile nav, main, footer...) 同原代码 -->
  <main style="height: 1200px;">
    <h1>Welcome to Mefan</h1>
    <p>滚动到轮播区域底部还差 180px 左右时，按钮先在中心出现并分裂，然后移动到底部 30px。离开时反向合并并消失。</p>
  </main>

  <!-- ========== 主功能脚本 ========== -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {

    /* A) 模拟原先的滚动切换导航脚本... (略)
       B) 模拟 轮播 + 播放/刷新/切换功能... (略)
       这里不再重复写，你可放你原有脚本或合并即可
    */

    /********************************************************
     * C) 分裂圆圈核心脚本
     * - 当 #section2-highlights 滚动到底部 <= -180px 时
     *   => 容器在中间scale(0)->scale(1)并分裂 => 移动到底部
     * - 离开时 => 反向合并到圆 => scale(0)
     ********************************************************/
    const section2    = document.getElementById('section2-highlights');
    const splitCircle = document.getElementById('splitCircle');
    const outerRing   = splitCircle.querySelector('.outer-ring');
    const innerCircle = splitCircle.querySelector('.inner-circle');

    let isActive  = false;  // 是否已经在显示(分裂)状态
    let isLeaving = false;  // 是否正在离场

    // 按钮点击演示
    splitCircle.addEventListener('click', () => {
      alert("Clicked the splitting circle!");
    });

    function onScroll() {
      const rect = section2.getBoundingClientRect();
      const distance = rect.bottom - window.innerHeight;
      // 距离底部 <= -180 => 执行出现动画
      if (distance <= -180 && distance > -2000) {
        if (!isActive) {
          showSplitCircle();
        }
      } else {
        if (isActive) {
          hideSplitCircle();
        }
      }
    }

    function showSplitCircle() {
      isActive  = true;
      isLeaving = false;
      splitCircle.classList.add('active'); // 让其可点击
      // 移除离场class
      splitCircle.classList.remove('leave');
      outerRing.classList.remove('leave');
      innerCircle.classList.remove('leave');
      // 添加进场class
      splitCircle.classList.add('enter');
      outerRing.classList.add('enter');
      innerCircle.classList.add('enter');
    }

    function hideSplitCircle() {
      isActive  = false;
      isLeaving = true;
      // 移除进场class
      splitCircle.classList.remove('enter');
      outerRing.classList.remove('enter');
      innerCircle.classList.remove('enter');
      // 添加离场class
      splitCircle.classList.add('leave');
      outerRing.classList.add('leave');
      innerCircle.classList.add('leave');
    }

    // 当离场动画结束后，彻底隐藏
    splitCircle.addEventListener('animationend', (e) => {
      // 监听 leave 动画最后一帧
      if (e.animationName === 'circleContainerLeave') {
        // 容器位移合并完成 => 不再可见
        splitCircle.classList.remove('active');
      }
    });
    outerRing.addEventListener('animationend', (e) => {
      // 动画结束后移除enter/leave类
      if (e.animationName === 'circleEnter' || e.animationName === 'circleEnterInner') {
        e.target.classList.remove('enter');
      }
      if (e.animationName === 'circleLeave') {
        e.target.classList.remove('leave');
      }
    });
    innerCircle.addEventListener('animationend', (e) => {
      if (e.animationName === 'circleEnter' || e.animationName === 'circleEnterInner') {
        e.target.classList.remove('enter');
      }
      if (e.animationName === 'circleLeave') {
        e.target.classList.remove('leave');
      }
    });

    // 监听滚动
    window.addEventListener('scroll', onScroll);
  });
  </script>
</body>
</html>
