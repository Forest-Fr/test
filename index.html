<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Native1 Scroll Snap Carousel</title>
  <style>
   * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #fff;
      color: #333;
      line-height: 1.6;
      padding-top: 40px; /* 原主导航高度 */
    }
@media (min-width: 769px) {

  /* ===== 轮播最外层容器 ===== */
  .natural1-carousel-container {
       position: relative;
      width: 100%;
      overflow: hidden;
      margin: auto;
      display: flex;
      justify-content: center;
      align-items: center;
top:12px;
  }

  /* ===== 轮播轨道 (原先使用 transform 过渡，现改用 scroll-snap) ===== */
  .natural1-carousel-track {
    display: flex;
    gap: 15px;
    /* 原 transform 过渡已注释 */
    /* transition: transform 0.5s ease-in-out; */
    justify-content: flex-start;

    /* Scroll Snap 相关 */
    overflow-x: auto;               /* 原生滚动 */
    scroll-snap-type: x mandatory;  /* 横向强制贴合 */
    scroll-behavior: smooth;        /* 平滑滚动 */
    -webkit-overflow-scrolling: touch;
    scroll-padding-left: 0;
    scroll-padding-right: 0;
  }
  .natural1-carousel-track::-webkit-scrollbar {
      display: none;
  }

  .natural1-carousel-slide {
     flex: 0 0 calc(85%);
      scroll-snap-align: center;
      height: 520px;
      position: relative;
  }

  .natural1-carousel-slide img {
    width: 100%; /* 图片充满卡片 */
    height: auto; 
    display: block;
    border-radius: 10px;
    filter: none !important;
    opacity: 1 !important;
  }

  .natural1-carousel-slide.shadow {
    filter: brightness(0.6);
    transition: filter 0.3s;
  }
  .natural1-carousel-slide.shadow::before {
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(255, 255, 255, 0.2); /* 半透明白色 */
    pointer-events: none;
  }

  /* ===== 覆盖层动画 & 文本/按钮等：原逻辑保持 ===== */
  .natural1-overlay {
    position: absolute;
    left: 10%;
    margin-top: 40px;
    z-index: 10;
    gap: 10px;
    display: inline-block;
    flex-direction: column;
    align-items: flex-start;
    opacity: 0;
    transform: translateY(50px);
    transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.8s ease-in-out;
    white-space: nowrap;
bottom:210px;
  }

  .natural1-bottom-row {
    display: flex;
    gap: 15px;
    position: relative;
    align-items: center;
    left: 5px;
    bottom: 15px;
    z-index: 999;
  }

.natural1-title {
    position: absolute;
    left: 0;
    bottom:90px;
    font-size:3.1rem;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.3), 0 0 25px rgba(255,255,255,0.5);
    padding-left:15px;
    opacity: 0;
    transform: translateY(40px);
    transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease-in-out;
    z-index: 999;
    white-space: nowrap;
  }

  natural1-button-title-group {
    position: relative;
    width:460px;  
    height: 210px; 
  }

  .natural1-text-bottom {
font-family: -apple-system, BlinkMacSystemFont, sans-serif;
display: inline-block;
  font-size: 17px;
  font-weight: 400;
  color: #fff;
  line-height: 1.4;
    position: static !important;
    bottom: 0px;
    opacity: 1;
    transform: translateY(40px);
    transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease-in-out;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0px;
    left: 0;
    padding-bottom: 0px;
    padding-left: 0px;
    margin: 0;
 vertical-align: middle;不管用
  }
.natural1-text-bottom {
  font-weight: 600;
}
  .natural1-text-top,
  .natural1-text-bottom {
    opacity: 0;
    transform: translateY(40px);
    transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease-in-out;
  }

  .natural1-carousel-slide.active .natural1-overlay {
    opacity: 1;
    transform: translateY(0);
  }
  .natural1-carousel-slide.active .natural1-explore-btn {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.4s; 
  }
  .natural1-carousel-slide.active .natural1-text-top,
  .natural1-carousel-slide.active .natural1-text-bottom {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.2s; 
  }

  .natural1-explore-btn {
 display: inline-block;
    background-color: #f5f5f7;        /* 浅灰白背景，接近 Apple 风格 */
  color: #000;                      /* 黑色文字 */
  padding: 12px 24px;               /* 上下左右内边距 */
  border: none;                     /* 无边框 */
  border-radius: 9999px;            /* 超大圆角，实现胶囊形状 */
  font-size: 17px;                  /* 字体大小 */
  font-weight: 500;                 /* 字重适中 */
  font-family: -apple-system, BlinkMacSystemFont, sans-serif; /* 苹果默认字体 */
  cursor: pointer;                 /* 鼠标悬停变手型 */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* 微弱阴影提升立体感 */
  transition: background-color 0.3s ease;
 transform: translateY(60px);
    transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.8s ease-in-out;
  position: static !important;
    margin: 0;
    z-index: 999;
    opacity: 0;



  }

  .natural1-explore-btn:hover {
    background-color: #e5e5e7;       /* 鼠标悬停时略深一点 */
  }

  .natural1-text-top {
    position: absolute;
    font-size: 1.8rem;
    font-weight: bold;
    margin-bottom: 320px;
    opacity: 1;
    transform: translateY(40px);
    transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease-in-out;
    z-index: 999;
    color: white; 
    text-shadow: 2px 2px 8px rgba(0,0,0,0.3), 0 0 25px rgba(255,255,255,0.5);
  }

  .natural1-carousel-slide.active .natural1-text-bottom {
    opacity: 1;
    transform: translateY(0);
  }
  .natural1-carousel-slide.active .natural1-title {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.4s;
  }

  /* ===== 小圆点容器 ===== */
  .natural1-carousel-dots-container {
    position: relative;
    width: 100%;
    height: 36px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .natural1-carousel-dots {
    display: flex;
    justify-content: center;
    position: absolute;
    bottom: 5px;
    width: 100%;
  }
  .natural1-carousel-dot {
    width: 10px;
    height: 10px;
    background: #ccc;
    border-radius: 50%;
    margin: 0 5px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .natural1-carousel-dot.active {
  background: #000; 
  }

  /* 桌面端隐藏prev/next按钮(保留原逻辑) */
  .natural1-carousel-prev,
  .natural1-carousel-next {
    display: none;
  }

  .natural1-button-title-group {
    position: absolute;
    left: 5px;
    top:130px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.8rem;
    font-weight: bold;
  }

  .natural1-title {
    position: absolute;
    left: 5px;
    bottom: calc(40px + 165px);
    font-size: 3.1rem;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3), 0 0 25px rgba(255, 255, 255, 0.5);
    padding-left: 5px;
    opacity: 1;
    transform: translateY(0);
    transition: transform 0.6s ease-in-out, opacity 0.6s ease-in-out;
  }

  .natural1-carousel-dots {
    display: block;
    text-align: center;
    margin-top: 15px;
  }
  .natural1-carousel-dot {
    display: inline-block;
    width: 10px;
    height: 10px;
    background: #ccc;
    border-radius: 50%;
    margin: 0 5px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .natural1-carousel-dot.active {
   background: #000;
  }

} /* End of @media (min-width: 769px) */


  
/* ========== 移动端适配 ========== */
@media (max-width: 768px) {

  .natural1-carousel-wrapper {
    margin-top: 12px;
    margin-bottom: 13px;
    position: relative;
  }

  .natural1-carousel-container {
    position: relative;
  width: 100vw;
  /* ✅ 去掉左右 padding */
  padding: 0;
  margin: 0 auto;
  overflow-x: hidden; /* ✅ 允许两侧图片 peek 出来 */
  height: 495px;
top:12px;
  }
  .natural1-carousel-container::-webkit-scrollbar {
    display: none;
  }

  .natural1-carousel-track {
    display: flex;
    gap: 15px;
    align-items: center;
    /* 原 transform 过渡注释掉 */
    /* transition: transform 0.5s ease-in-out; */
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }

  .natural1-carousel-slide {
   flex: 0 0 66vw; /* ✅ 保证主图宽度，单位 vw 更直观 */
      scroll-snap-align: center;
      height: 495px;
      position: relative;
 aspect-ratio: 9 / 16;
  }

  .natural1-carousel-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    filter: none !important;
    opacity: 1 !important;
  }

  .natural1-carousel-slide.shadow {
    filter: brightness(0.6);
    transition: filter 0.3s;
  }
  .natural1-carousel-slide.shadow::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.2); /* 半透明白色叠加 */
    pointer-events: none;
  }

  .natural1-overlay {
    position: absolute;
    padding-bottom: 0px;
    z-index: 1001;
    gap: 10px;
    display: inline-block;
    flex-direction: column;
    align-items: flex-start;
    opacity: 0;
    transition: transform 0.8s cubic-bezier(0.22,1,0.36,1), opacity 0.8s ease-in-out;
    white-space: nowrap;
    margin: 0;
transform: translateY(40px);  /* 初始向下 */

  }
  .natural1-carousel-slide.active .natural1-overlay {
    opacity: 1;
 transform: translateY(0); /* 文字从下方上升 */
  }

  .natural1-button-title-group {
    position: relative;
    width:460px;  
    height: 210px; 
  }

  .natural1-bottom-row {
    display: flex;
 align-items: flex-start;  /* 左对齐 */
    position: relative;   /* 或绝对定位也可，看需求 */
align-items: center;       /* 垂直居中对齐 */原  Yuanalign-items和flex-end; /* 元素间的底部对齐 */
    gap: 10px;                 /* 按钮和文字之间 15px 间距 */
left: 5px;                 /* 与你原先的左边对齐保持一致 */
    bottom: 125px;              /* 调整到合适的离底部距离 */
    z-index: 999;             /* 确保在图片之上 */

  }

  .natural1-title {
position: fixed;
    left: 5px;
     bottom: calc(30px + 585px);原yuanbottom和calc( (85vw / 1.43) - 20px ); /* 调整标题位置，根据卡片高度（85vw/1.43） */
    font-size: 1.8rem;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
    padding-left: 65px;
    opacity: 0;
transform: translateY(40px);  /* 初始向下 */

   transition: transform 0.8s ease, opacity 0.8s ease;
    z-index: 999;
    white-space: nowrap;
    display: inline-block;
    overflow: visible;




  }

  .natural1-text-bottom {
font-size: 16px; /* 调整文字大小 */
    opacity: 1;
padding-bottom:12px; /* 将文字稍微放低一点，保持适当的间距 */原yuanmargin-bottom和20px; /* 使底部文字和explore now按钮间距10px */
padding-left:65px; /* 水平向右移动65px */原20
Margin:0;
    align-items: center;
    display: flex;
    flex-direction: column;
    gap: 10px; /* 上下文字之间的间距 */
    text-align: center;
color: #fff !important; /* 强制白色 */
  z-index: 1001;
    position: static !important;
 opacity: 0;
  transform: translateY(40px);  /* 初始向下 */
  }
 .natural1-text-bottom::before {
    content: "不太像";
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 0px;
 }
 .natural1-text-bottom {
    /* 去掉“模拟”字，只保留“Apple TV播放” */
    /* 原有内容中只保留“Apple TV播放” */
 }
  .natural1-carousel-slide.active .natural1-title {
    opacity: 1;
    transform: translateY(0); /* 文字从下方上升 */
    transition-delay: 0.4s;
  }
  .natural1-text-bottom,
  .natural1-text-top {
transform: translateY(40px);  /* 初始向下 */

  opacity: 0;
  transition: transform 0.8s ease, opacity 0.8s ease;
  }
  .natural1-carousel-slide.active .natural1-text-bottom,
  .natural1-carousel-slide.active .natural1-text-top {
    opacity: 1;
   transform: translateY(0); /* 文字从下方上升 */
    transition-delay: 0.2s;
  }

  .natural1-explore-btn {
display: inline-block;
    background-color: #f5f5f7;        /* 浅灰白背景，接近 Apple 风格 */
  color: #000;                      /* 黑色文字 */
  padding: 10px 18px;               /* 上下左右内边距 */
  font-weight: 300;                 /* 字重适中 */
  font-family: -apple-system, BlinkMacSystemFont, sans-serif; /* 苹果默认字体 */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* 微弱阴影提升立体感 */
    bottom: 12px;
transform: translateY(40px);  /* 初始向下 */

  font-size: 16px;                  /* 字体大小 */
    border: none;
  border-radius: 9999px;            /* 超大圆角，实现胶囊形状 */
    cursor: pointer;
    z-index: 1002;
    opacity: 0;
    flex-direction: column;
    align-items: center;
  transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease-in-out;
    font-weight: bold;
    position: absolute;
    margin: 0;
    white-space: nowrap;
    display: flex;
    width: auto;
left:85px;
bottom:-27px;
  }
  .natural1-carousel-slide.active .natural1-explore-btn {
    opacity: 1;
transform: translateY(0); /* 文字从下方上升 */
    transition-delay: 0.4s;
  }
.natural1-carousel-dots-container {
    position: relative;
    width: 100%;
    height: 18px;原36
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 8px;
  }
  .natural1-carousel-dots {
     display: flex;
    gap: 5px;
    justify-content: center;
    position: absolute;
    bottom: 5px;
    width: 100%;
  }
  .natural1-carousel-dot {
    display: inline-block;
    width: 10px;
    height: 10px;
    background: #ccc;
    border-radius: 50%;
    margin: 0 5px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .natural1-carousel-dot.active {
    background: #000; /* 手机端激活态也为黑色 */
  }

  /* 移动端下左右按钮可见 */
  .natural1-carousel-prev,
  .natural1-carousel-next {
    display: block;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    font-size: 2rem;
    color: white;
    padding: 15px !important;
    z-index: 999;
    cursor: pointer;
  }
  .natural1-carousel-prev {
    left: calc(10px - 20px);
  }
  .natural1-carousel-next {
    right: calc(10px - 20px);
  }

}
  </style>
</head>
<body>


<div class="natural1-carousel-container">
  <!-- 左侧切换按钮 -->
  <button class="natural1-carousel-prev">&lt;</button>

  <!-- 
    外层包裹 .natural1-carousel-track-wrapper
    不改动，保持原结构
  -->
  <div class="natural1-carousel-track-wrapper">
    <div class="natural1-carousel-track">
      
      <!-- 轮播项1 -->
      <div class="natural1-carousel-slide">
        <a href="example.html" target="_blank">
          <img src="nature1.png" alt="nature1">
        </a>
        <div class="natural1-overlay">
          <div class="natural1-button-title-group">
            <div class="natural1-bottom-row">
              <button class="natural1-explore-btn" 
                      onclick="window.open('example.html', '_blank')">
                Explore now
              </button>
              <div class="natural1-text-bottom">模拟.Apple TV原生播放.</div>
            </div>
            <div class="natural1-title">scoll carousel优化不足</div>
          </div>
        </div>
      </div>

      <!-- 轮播项2 -->
      <div class="natural1-carousel-slide">
        <a href="example.html" target="_blank">
          <img src="nature2.png" alt="nature2">
        </a>
        <div class="natural1-overlay">
          <div class="natural1-button-title-group">
            <div class="natural1-bottom-row">
              <button class="natural1-explore-btn"
                      onclick="window.open('example.html', '_blank')">
                Explore now
              </button>
              <div class="natural1-text-bottom">模拟.Apple TV原生播放.</div>
            </div>
            <div class="natural1-title">移动端划快等问题</div>
          </div>
        </div>
      </div>

      <!-- 轮播项3 -->
      <div class="natural1-carousel-slide">
        <a href="example.html" target="_blank">
          <img src="nature3.png" alt="nature3">
        </a>
        <div class="natural1-overlay">
          <div class="natural1-button-title-group">
            <div class="natural1-bottom-row">
              <button class="natural1-explore-btn"
                      onclick="window.open('example.html', '_blank')">
                Explore now
              </button>
              <div class="natural1-text-bottom">模拟.Apple TV原生播放.</div>
            </div>
            <div class="natural1-title">虽不偏移</div>
          </div>
        </div>
      </div>

      <!-- 轮播项4 -->
      <div class="natural1-carousel-slide">
        <a href="example.html" target="_blank">
          <img src="nature4.png" 
               alt="nature4">
        </a>
        <div class="natural1-overlay">
          <div class="natural1-button-title-group">
            <div class="natural1-bottom-row">
              <button class="natural1-explore-btn"
                      onclick="window.open('example.html', '_blank')">
                Explore now
              </button>
              <div class="natural1-text-bottom">模拟.Apple TV原生播放.</div>
            </div>
            <div class="natural1-title">快闪等不益做自动播放</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- 右侧切换按钮 -->
  <button class="natural1-carousel-next">&gt;</button>
</div>

<!-- 小圆点容器 (保留不变) -->
<div class="natural1-carousel-dots-container">
  <div class="natural1-carousel-dots">
    <span class="natural1-carousel-dot"></span>
    <span class="natural1-carousel-dot"></span>
    <span class="natural1-carousel-dot"></span>
    <span class="natural1-carousel-dot"></span>
  </div>
</div>



<script>
(function(){
  // ============== A) 等所有slide图片加载完，再初始化 ==============
  const container = document.querySelector(".natural1-carousel-container");
  if (container) container.style.visibility = "hidden";
  const allImgs = Array.from(document.querySelectorAll(".natural1-carousel-slide img"));

  function waitImagesLoaded(images, callback) {
    let loadedCount=0;
    const total= images.length;
    if(total===0){
      callback();
      return;
    }
    images.forEach((img)=>{
      if(img.complete){
        checkDone();
      } else {
        img.addEventListener("load", checkDone);
        img.addEventListener("error", checkDone);
      }
    });
    function checkDone(){
      loadedCount++;
      if(loadedCount>= total){
        callback();
      }
    }
  }

  waitImagesLoaded(allImgs, ()=>{
    if(!container) return;
    // 如果移动端 => initMobile; 否则 => initDesktop
    const isMobile= window.innerWidth<=768;
    if(isMobile){
      initSnapCarouselMobile(); // 新增的三套Slides逻辑
    } else {
      initSnapCarouselDesktop(); // 保留你提供的原桌面端逻辑
    }
    container.style.visibility= "visible";
  });


  // ==============================================================
  // B) 移动端: 三套Slides + Peek Preview + 无缝环绕
  // ==============================================================
  function initSnapCarouselMobile(){
    console.log("[Carousel] Mobile triple-set approach (optimized).");

    const track = document.querySelector(".natural1-carousel-track");
    const container= document.querySelector(".natural1-carousel-container");
    let slides= Array.from(track.querySelectorAll(".natural1-carousel-slide"));

    const prevBtn= document.querySelector(".natural1-carousel-prev");
    const nextBtn= document.querySelector(".natural1-carousel-next");
    const dots= Array.from(document.querySelectorAll(".natural1-carousel-dot"));

    if(!track|| slides.length===0 || !container) return;

    // 1) 原始slides
    const original= slides.slice();
    const totalReal= original.length;

    // 2) 清空 track, 三套
    track.innerHTML="";
    //   第一套
    original.forEach(sl=> track.appendChild(sl.cloneNode(true)));
    //   第二套(中间)
    original.forEach(sl=> track.appendChild(sl.cloneNode(true)));
    //   第三套
    original.forEach(sl=> track.appendChild(sl.cloneNode(true)));

    slides= Array.from(track.querySelectorAll(".natural1-carousel-slide"));
    const totalSlides= slides.length; // 3 * totalReal
    let currentIndex= totalReal; // 中间套开始

    // 2.1) 滚到指定索引
    function scrollToIndex(i, smooth=true){
      if(i<0) i=0;
      if(i>= totalSlides) i= totalSlides-1;
      const target= slides[i];
      if(!target) return;
      track.style.scrollBehavior= smooth?"smooth":"auto";
      target.scrollIntoView({
        behavior: smooth?"smooth":"auto",
        block:"nearest",
        inline:"center"
      });
    }

    // 2.2) 初始化 => 滚到中间套
    function init(){
      track.style.scrollBehavior="auto";
      scrollToIndex(currentIndex,false);
      track.style.scrollBehavior="smooth";
      updateClasses();
    }

    // 2.3) 计算当前激活
    function getActiveIndex(){
      const cRect= container.getBoundingClientRect();
      const cCenter= cRect.left + cRect.width/2;
      let minDiff= Infinity, activeI= currentIndex;
      slides.forEach((sl,i)=>{
        const slRect= sl.getBoundingClientRect();
        const slCenter= slRect.left + slRect.width/2;
        const diff= Math.abs(slCenter- cCenter);
        if(diff< minDiff){
          minDiff= diff;
          activeI= i;
        }
      });
      return activeI;
    }

    // mapToRealIndex => 0.. (totalReal-1)
    function mapToRealIndex(i){
      return i % totalReal;
    }

    // 2.4) 更新类名 + dots
    function updateClasses(){
      const activeI= getActiveIndex();
      slides.forEach(s=> s.classList.remove("active","prev","next","shadow"));
      slides[activeI]?.classList.add("active");

      const nextI= (activeI+1)% totalSlides;
      const prevI= (activeI-1+ totalSlides)% totalSlides;
      slides[nextI]?.classList.add("next");
      slides[prevI]?.classList.add("prev");
      slides.forEach(s=>{
        if(!s.classList.contains("active")){
          s.classList.add("shadow");
        }
      });
      // dots
      const dotIndex= mapToRealIndex(activeI);
      dots.forEach((d,i)=>{
        d.classList.toggle("active", i===dotIndex);
      });
    }

    // 2.5) 修正(若到第一/第三套 => 回中间套)
    function fixCloneIndex(){
      const activeI= getActiveIndex();
      // 第1套 => [0.. totalReal-1]
      if(activeI< totalReal){
        const realI= activeI;
        currentIndex= realI+ totalReal;
        track.style.scrollBehavior="auto";
        scrollToIndex(currentIndex,false);
        track.style.scrollBehavior="smooth";
      }
      // 第3套 => [2*totalReal..(3*totalReal-1)]
      else if(activeI>= 2*totalReal){
        const realI= activeI- 2*totalReal;
        currentIndex= realI+ totalReal;
        track.style.scrollBehavior="auto";
        scrollToIndex(currentIndex,false);
        track.style.scrollBehavior="smooth";
      }
      else {
        currentIndex= activeI;
      }
    }

    // 2.6) scroll事件 => fix + update
    let scrollTimer=null;
    track.addEventListener("scroll", ()=>{
      if(scrollTimer) clearTimeout(scrollTimer);
      scrollTimer= setTimeout(()=>{
        fixCloneIndex();
        updateClasses();
      },150);
    });

    // 2.7) 切换 => next/prev
    function nextSlide(){
      currentIndex++;
      if(currentIndex>= totalSlides) currentIndex= totalSlides-1;
      scrollToIndex(currentIndex,true);
    }
    function prevSlide(){
      currentIndex--;
      if(currentIndex<0) currentIndex=0;
      scrollToIndex(currentIndex,true);
    }

    // 2.8) 自动播放
    let autoTimer= setInterval(nextSlide,5000);
    function resetAutoTimer(){
      clearInterval(autoTimer);
      autoTimer= setInterval(nextSlide,5000);
    }

    // 2.9) 按钮 + dots
    prevBtn?.addEventListener("click", e=>{
      e.stopPropagation();
      prevSlide();
      resetAutoTimer();
    });
    nextBtn?.addEventListener("click", e=>{
      e.stopPropagation();
      nextSlide();
      resetAutoTimer();
    });
    dots.forEach((dot,i)=>{
      dot.addEventListener("click",(e)=>{
        e.stopPropagation();
        currentIndex= i+ totalReal;
        scrollToIndex(currentIndex,true);
        resetAutoTimer();
      });
    });

    // 2.10) slide点击 => next/prev
    slides.forEach(sl=>{
      sl.addEventListener("click",(e)=>{
        if(sl.classList.contains("active")){
          // do nothing
        } else if(sl.classList.contains("next")){
          e.preventDefault();
          nextSlide();
          resetAutoTimer();
        } else if(sl.classList.contains("prev")){
          e.preventDefault();
          prevSlide();
          resetAutoTimer();
        }
      });
      const exploreBtn= sl.querySelector(".natural1-explore-btn");
      if(exploreBtn){
        exploreBtn.addEventListener("click",(ev)=>{
          ev.stopPropagation();
        });
      }
    });

    // 2.11) 触摸滑动
    let startX=0, isSwiping=false;
    track.addEventListener("touchstart",(e)=>{
      if(e.touches.length===1){
        startX= e.touches[0].clientX;
        isSwiping= true;
      }
    }, {passive:true});
    track.addEventListener("touchmove",()=>{}, {passive:true});
    track.addEventListener("touchend",(e)=>{
      if(!isSwiping) return;
      isSwiping= false;
      const diff= e.changedTouches[0].clientX- startX;
      if(Math.abs(diff)>20){
        diff<0? nextSlide(): prevSlide();
        resetAutoTimer();
      }
    }, {passive:true});

    // 2.12) resize => fix
    window.addEventListener("resize", ()=>{
      fixCloneIndex();
      updateClasses();
    });

    // init
    init();
  }


  // =====================================================================
  // C) 桌面端: 保留你原桌面端逻辑(只克隆首尾)
  // =====================================================================
  function initSnapCarouselDesktop(){
    console.log("[Carousel] Desktop => Original logic (unchanged).");

    const container = document.querySelector(".natural1-carousel-container");
    const track = document.querySelector(".natural1-carousel-track");
    let slides = Array.from(track.querySelectorAll(".natural1-carousel-slide"));

    const prevBtn = document.querySelector(".natural1-carousel-prev");
    const nextBtn = document.querySelector(".natural1-carousel-next");
    const dots = Array.from(document.querySelectorAll(".natural1-carousel-dot"));

    if (!container || !track || slides.length === 0) return;

    const totalReal = slides.length;
    let currentIndex = 1;
    let scrollTimer = null;

    // ========== 1) 克隆首尾 ==========
    const firstClone = slides[0].cloneNode(true);
    const lastClone = slides[slides.length - 1].cloneNode(true);
    track.appendChild(firstClone);
    track.insertBefore(lastClone, slides[0]);
    slides = Array.from(track.querySelectorAll(".natural1-carousel-slide"));

    // ========== 2) 初始 => 滚到索引1(第一张真实slide) ==========
    function setInitialPos() {
      track.style.scrollBehavior = "auto";
      slides[1].scrollIntoView({ behavior:"auto", block:"nearest", inline:"center" });
      track.style.scrollBehavior = "smooth";
    }
    setInitialPos();

    // ========== 3) 根据容器中心计算激活slide ==========
    function getActiveIndex() {
      const rect = container.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      let minDiff = Infinity, activeI = 1;
      slides.forEach((sl, i) => {
        const slRect = sl.getBoundingClientRect();
        const slCenterX = slRect.left + slRect.width / 2;
        const diff = Math.abs(slCenterX - centerX);
        if (diff < minDiff) {
          minDiff = diff;
          activeI = i;
        }
      });
      return activeI;
    }

    // ========== 4) 更新类名/ dots/ shadow ==========
    function updateClasses() {
      const activeI = getActiveIndex();
      slides.forEach((s) => s.classList.remove("active","prev","next","shadow"));
      slides[activeI]?.classList.add("active");
      const nextI = (activeI + 1) % slides.length;
      const prevI = (activeI - 1 + slides.length) % slides.length;
      slides[nextI]?.classList.add("next");
      slides[prevI]?.classList.add("prev");
      slides.forEach((s) => {
        if (!s.classList.contains("active")) {
          s.classList.add("shadow");
        }
      });
      let dotIndex;
      if (activeI === 0) {
        dotIndex = totalReal - 1;
      } else if (activeI === slides.length - 1) {
        dotIndex = 0;
      } else {
        dotIndex = activeI - 1;
      }
      dots.forEach((d, i) => {
        d.classList.toggle("active", i === dotIndex);
      });
    }

    // ========== 5) 无缝修正：若在克隆区 => 瞬间跳到真实slide ==========
    function fixCloneIndex() {
      const activeI = getActiveIndex();
      if (activeI === 0) {
        // 左克隆 => 跳到最后真实
        currentIndex = totalReal;
        track.style.scrollBehavior = "auto";
        slides[currentIndex].scrollIntoView({ block:"nearest", inline:"center" });
        track.style.scrollBehavior = "smooth";
      } else if (activeI === slides.length - 1) {
        // 右克隆 => 跳到第1张真实
        currentIndex = 1;
        track.style.scrollBehavior = "auto";
        slides[currentIndex].scrollIntoView({ block:"nearest", inline:"center" });
        track.style.scrollBehavior = "smooth";
      } else {
        currentIndex = activeI;
      }
    }

    // ========== 6) scroll事件 (用户手动滑动) ==========
    track.addEventListener("scroll", () => {
      if (scrollTimer) clearTimeout(scrollTimer);
      scrollTimer = setTimeout(() => {
        fixCloneIndex();
        updateClasses();
      }, 150);
    });

    // ========== 7) 切换 => next/prev, 与原脚本一致 ==========
    function nextSlide() {
      // 若当前已是 slides.length-2(最后真实slide)
      // => 下一个会是 slides.length-1(克隆)
      // => 先瞬间回到第一张
      if (currentIndex === slides.length - 2) {
        track.style.scrollBehavior = "auto";
        currentIndex = 1;
        slides[currentIndex].scrollIntoView({ block:"nearest", inline:"center" });
        track.style.scrollBehavior = "smooth";
      } else {
        currentIndex++;
        scrollToIndex(currentIndex, true);
      }
    }
    function prevSlide() {
      // 若当前=1 => 上一个=0(克隆) => 瞬间回到最后真实
      if (currentIndex === 1) {
        track.style.scrollBehavior = "auto";
        currentIndex = totalReal;
        slides[currentIndex].scrollIntoView({ block:"nearest", inline:"center" });
        track.style.scrollBehavior = "smooth";
      } else {
        currentIndex--;
        scrollToIndex(currentIndex, true);
      }
    }
    function scrollToIndex(i, smooth=true) {
      if (i<0) i=0;
      if(i>= slides.length) i= slides.length-1;
      const target= slides[i];
      if(!target) return;
      track.style.scrollBehavior= smooth?"smooth":"auto";
      target.scrollIntoView({
        behavior: smooth?"smooth":"auto",
        block:"nearest",
        inline:"center"
      });
    }

    // ========== 8) 自动播放 ==========
    let autoTimer= setInterval(nextSlide, 5000);
    function resetAutoTimer() {
      clearInterval(autoTimer);
      autoTimer= setInterval(nextSlide, 5000);
    }

    // ========== 9) 按钮 & dots & 点击slide ==========
    prevBtn?.addEventListener("click",(e)=>{
      e.stopPropagation();
      prevSlide();
      resetAutoTimer();
    });
    nextBtn?.addEventListener("click",(e)=>{
      e.stopPropagation();
      nextSlide();
      resetAutoTimer();
    });
    dots.forEach((dot,i)=>{
      dot.addEventListener("click",(e)=>{
        e.stopPropagation();
        currentIndex= i+1; // dot i => slides[i+1]
        scrollToIndex(currentIndex,true);
        resetAutoTimer();
      });
    });
    slides.forEach((slide)=>{
      slide.addEventListener("click",(e)=>{
        if(slide.classList.contains("active")){
          // do nothing
        } else if(slide.classList.contains("next")){
          e.preventDefault();
          nextSlide();
          resetAutoTimer();
        } else if(slide.classList.contains("prev")){
          e.preventDefault();
          prevSlide();
          resetAutoTimer();
        }
      });
      const exploreBtn= slide.querySelector(".natural1-explore-btn");
      if(exploreBtn){
        exploreBtn.addEventListener("click",(ev)=>{
          ev.stopPropagation();
        });
      }
    });

    // ========== 10) 触摸滑动 ==========
    let startX=0, isSwiping=false;
    track.addEventListener("touchstart",(e)=>{
      if(e.touches.length===1){
        startX= e.touches[0].clientX;
        isSwiping= true;
      }
    }, {passive:true});
    track.addEventListener("touchmove",()=>{}, {passive:true});
    track.addEventListener("touchend",(e)=>{
      if(!isSwiping) return;
      isSwiping= false;
      const diff= e.changedTouches[0].clientX - startX;
      if(Math.abs(diff)>20){
        diff<0? nextSlide(): prevSlide();
        resetAutoTimer();
      }
    }, {passive:true});

    // ========== 11) 初始化 ==========
    function init(){
      track.style.scrollBehavior="auto";
      scrollToIndex(currentIndex,false);
      track.style.scrollBehavior="smooth";
      updateClasses();
    }
    init();

    // ========== 12) resize时校正 ==========
    window.addEventListener("resize", ()=>{
      fixCloneIndex();
      updateClasses();
    });
  }


  // ====================================================
  // ============== 入口：调用“桌面/移动端” ==============
  // ====================================================
  function initSnapCarousel(){
    const isMobile= window.innerWidth<=768;
    if(isMobile){
      initSnapCarouselMobile();
    } else {
      initSnapCarouselDesktop();
    }
  }

})();
</script>






</body>
</html>
