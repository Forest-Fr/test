<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>MeFan - 合二为一 & 分裂按钮 Demo</title>
  <style>
    /* ======= 基础重置 & 布局 ======= */
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      line-height: 1.6;
      background: #fff; color: #333;
      padding-top: 60px; /* 模拟导航高度 */
    }
    .header {
      position: fixed; top: 0; left: 0; width: 100%; height: 60px;
      background: linear-gradient(to right, #DEEFFF, #B2D8FF);
      z-index: 3000;
      display: flex; align-items: center; padding: 0 20px;
    }

    /* ======= 模拟轮播区 ======= */
    .section2 {
      position: relative;
      width: 80%; max-width: 1013px;
      margin: 0 auto; padding: 30px; text-align: center;
      background: #f9f9f9; border: 1px solid #ddd;
      margin-top: 50px;
    }
    .carousel {
      width: 100%; overflow: hidden;
      border: 2px solid #ccc; padding: 10px;
      min-height: 300px; /* 模拟内容高度 */
    }
    .carousel img {
      max-width: 100%;
    }

    /* ====== 两部分按钮外容器 ======
       初始放在轮播容器“中间”位置 */
    .two-part-btn-wrap {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
      width: 200px; /* 宽度要容纳左胶囊+右圆 */
      height: 60px;
      pointer-events: none;
      z-index: 9999;
    }
    .two-part-btn-wrap.active {
      pointer-events: auto; /* 激活后可点击 */
    }

    /* ========== 子元素：合并态 vs 分裂态 ========== */
    .merged-btn {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #f2f2f2;
      border-radius: 30px; /* 大胶囊 */
      border: 2px solid #007aff; /* Apple 蓝 */
      display: flex; align-items: center; justify-content: center;
      opacity: 1; /* 合并态初始可见 */
    }
    /* 分裂后出现的左胶囊 + 右圆 */
    .left-pill,
    .right-circle {
      position: absolute;
      top: 0; bottom: 0;
      opacity: 0; /* 初始隐藏 */
      transition: opacity 0.1s ease;
    }
    .left-pill {
      left: 0;
      width: 140px;
      background: #f2f2f2;
      border: 2px solid #007aff;
      border-radius: 30px;
      display: flex; align-items: center; justify-content: center;
      gap: 6px;
      padding: 0 10px;
    }
    .right-circle {
      right: 0;
      width: 60px;
      background: #fff; /* 也可 #f2f2f2 看你风格 */
      border: 2px solid #007aff;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
    }

    /* 左胶囊里的进度条(假设) */
    .progress-bar {
      width: 40px; height: 8px;
      background: #666; border-radius: 4px;
    }
    .dot {
      width: 6px; height: 6px;
      background: #666; border-radius: 50%;
    }
    /* 右圆里的播放图标 */
    .play-icon {
      width: 0; height: 0;
      border-top: 6px solid transparent;
      border-bottom: 6px solid transparent;
      border-left: 10px solid #333;
      margin-left: 2px;
    }

    /* ========== 动画关键帧 ========== */
    /* 1) 容器：从中心放大 -> 移动到底部30px */
    @keyframes containerEnter {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
      40% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      60% {
        /* 这里开始分裂子元素, 但容器仍在中间 */
        transform: translate(-50%, -50%) scale(1);
      }
      100% {
        /* 最后移动到底部 30px (根据容器实际高度微调) */
        transform: translate(-50%, calc(-50% + 140px)) scale(1);
        opacity: 1;
      }
    }
    @keyframes containerLeave {
      0% {
        transform: translate(-50%, calc(-50% + 140px)) scale(1);
        opacity: 1;
      }
      40% {
        /* 移回中间 */
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
    }

    /* 2) 子元素：合并态 vs 分裂态 */
    @keyframes mergedBtnFadeOut {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }
    @keyframes mergedBtnFadeIn {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }
    /* 分裂态出现/消失 */
    @keyframes leftPillFadeIn {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes leftPillFadeOut {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }
    @keyframes rightCircleFadeIn {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes rightCircleFadeOut {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }

    /* ========== 进场时: 先显示 merged-btn, 然后 fade out -> show left/right ========== */
    .two-part-btn-wrap.enter {
      animation: containerEnter 1.2s forwards ease-in-out;
    }
    .merged-btn.enter {
      animation: mergedBtnFadeOut 0.6s 0.6s forwards ease-in-out;
      /* 先等容器进入0.6s再执行fadeOut => 1.2s与之衔接 */
    }
    .left-pill.enter,
    .right-circle.enter {
      animation: leftPillFadeIn 0.6s 1.0s forwards ease-in-out; /* 或some offset */
      /* 这里写死了0.6s+1.0s，不同元素可略微不同offset */
    }
    .right-circle.enter {
      animation-name: rightCircleFadeIn;
      animation-delay: 1.0s;
    }

    /* ========== 离场时: 先 fade out left/right -> fade in merged => containerLeave ========== */
    .two-part-btn-wrap.leave {
      animation: containerLeave 1.2s forwards ease-in-out;
    }
    .left-pill.leave,
    .right-circle.leave {
      animation: leftPillFadeOut 0.5s 0s forwards ease-in-out;
      /* 同步先把它们隐藏 */
    }
    .right-circle.leave {
      animation-name: rightCircleFadeOut;
    }
    .merged-btn.leave {
      animation: mergedBtnFadeIn 0.5s 0.5s forwards ease-in-out;
      /* 在它们消失后(0.5s)再出现mergedBtn */
    }

  </style>
</head>
<body>
  <!-- 模拟固定导航 -->
  <div class="header">
    <h1>Header &amp; Nav</h1>
  </div>

  <!-- 模拟轮播区 -->
  <section class="section2" id="section2">
    <h2>轮播示例区域</h2>
    <div class="carousel">
      <img src="https://via.placeholder.com/800x300.png?text=Carousel+Slide" alt="demo">
    </div>

    <!-- 两部分按钮容器 -->
    <div class="two-part-btn-wrap" id="twoPartBtn">
      <!-- 合并态 -->
      <div class="merged-btn" id="mergedBtn">
        <!-- 你可放个大图标，或文字“LOADING...”之类 -->
        <span style="font-size: 1.2rem; color: #333;">Loading…</span>
      </div>
      <!-- 分裂态 (左胶囊) -->
      <div class="left-pill" id="leftPill">
        <div class="progress-bar"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <!-- 分裂态 (右圆形) -->
      <div class="right-circle" id="rightCircle">
        <div class="play-icon"></div>
      </div>
    </div>
  </section>

  <main style="height: 1200px; padding: 20px;">
    <h2>页面内容</h2>
    <p>向下滚动到轮播区底部, 按 distance <= -180, 即会触发按钮渐入, 先是一个合并的大胶囊, 再分裂成两个, 并移动到距离底部30px处.</p>
  </main>

  <script>
  document.addEventListener('DOMContentLoaded', function(){
    const section2  = document.getElementById('section2');
    const twoPartBtn = document.getElementById('twoPartBtn');
    const mergedBtn  = document.getElementById('mergedBtn');
    const leftPill   = document.getElementById('leftPill');
    const rightCircle= document.getElementById('rightCircle');

    let isActive = false;  // 当前是否已显示(分裂态)
    // 监听滚动
    window.addEventListener('scroll', onScroll);

    function onScroll(){
      const rect = section2.getBoundingClientRect();
      const distance = rect.bottom - window.innerHeight; 
      if(distance <= -180 && distance > -2000){ // 你可调区间
        if(!isActive){
          showTwoPartBtn();
        }
      } else {
        if(isActive){
          hideTwoPartBtn();
        }
      }
    }

    function showTwoPartBtn(){
      isActive = true;
      twoPartBtn.classList.add('active');  // pointer-events 生效
      twoPartBtn.classList.remove('leave');
      twoPartBtn.classList.add('enter');

      mergedBtn.classList.remove('leave');
      mergedBtn.classList.add('enter');

      leftPill.classList.remove('leave');
      leftPill.classList.add('enter');

      rightCircle.classList.remove('leave');
      rightCircle.classList.add('enter');
    }
    function hideTwoPartBtn(){
      isActive = false;
      twoPartBtn.classList.remove('enter');
      twoPartBtn.classList.add('leave');

      mergedBtn.classList.remove('enter');
      mergedBtn.classList.add('leave');

      leftPill.classList.remove('enter');
      leftPill.classList.add('leave');

      rightCircle.classList.remove('enter');
      rightCircle.classList.add('leave');
    }

    // 你可给按钮加点击事件
    leftPill.addEventListener('click', function(e){
      alert("点击了左侧胶囊！");
      e.stopPropagation(); // 阻止冒泡
    });
    rightCircle.addEventListener('click', function(e){
      alert("点击了右侧播放按钮！");
      e.stopPropagation();
    });
  });
  </script>
</body>
</html>
