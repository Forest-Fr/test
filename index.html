<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>MeFan - Splitting Button with Gap</title>
  <style>
    /* ========== 基础重置 ========== */
    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: sans-serif;
      line-height: 1.5;
      padding-top: 60px; /* 模拟顶部导航高度 */
      background: #fff; color: #333;
    }
    .header {
      position: fixed; top: 0; left: 0; width: 100%; height: 60px;
      background: linear-gradient(to right, #DEEFFF, #B2D8FF);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 20px; z-index: 3000;
    }
    .header h1 {
      font-size: 1.2rem; color: #444;
    }

    /* ========== 模拟轮播容器 ========== */
    .carousel-container {
      position: relative;
      width: 80%; max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      text-align: center;
    }
    .carousel {
      width: 100%; height: 300px;
      display: flex; align-items: center; justify-content: center;
      background: #eee;
      font-size: 1.5rem; color: #666;
    }

    /* ========== 按钮容器(一体/两部分) ========== */
    .two-part-btn-wrap {
      position: absolute;
      /* 让其初始出现在容器“正中央” */
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
      width: 200px; /* 容器宽度，可容纳“左胶囊+右圆”并留中间空隙 */
      height: 60px;
      pointer-events: none; /* 初始不可点击 */
      z-index: 9999;
    }
    .two-part-btn-wrap.active {
      pointer-events: auto; /* 激活后可点 */
    }

    /* ========== 合并态(大圆) ========== */
    .merged-circle {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      border: 2px solid #007aff;
      border-radius: 50%;
      background: #f2f2f2;
      display: flex; align-items: center; justify-content: center;
      opacity: 1;
      transition: opacity 0.3s ease;
    }
    /* 你可放图标或文字在合并态圆里 */
    .merged-circle span {
      font-size: 1rem; color: #333; font-weight: bold;
    }

    /* ========== 分裂态(左胶囊 + 右圆)，中间留明确的间距 ========== */
    .left-pill,
    .right-circle {
      position: absolute;
      top: 0; bottom: 0;
      opacity: 0; /* 初始隐藏 */
    }
    /* 让“左胶囊”放在容器左侧 (0~140px)，“右圆”放在容器右侧(140~200px) => 中间空隙20px */
    .left-pill {
      left: 0;
      width: 140px; /* 占容器的左 140px */
      background: #f2f2f2;
      border: 2px solid #007aff;
      border-radius: 30px;
      display: flex; align-items: center; justify-content: center;
      gap: 6px; /* 小间隙 */
      padding: 0 12px;
    }
    .right-circle {
      right: 0;
      width: 60px; /* 剩余区域(200-140=60) */
      border: 2px solid #007aff;
      border-radius: 50%;
      background: #fff;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
    }
    /* 左胶囊内部(进度条+四个小圆点) */
    .progress-bar {
      width: 40px; height: 8px; background: #666; border-radius: 4px;
    }
    .dot {
      width: 6px; height: 6px; background: #666; border-radius: 50%;
    }
    /* 右圆里的播放图标 */
    .play-icon {
      width: 0; height: 0;
      border-top: 6px solid transparent;
      border-bottom: 6px solid transparent;
      border-left: 10px solid #333;
      margin-left: 2px;
    }

    /* ========== 动画关键帧 ========== */
    /* 容器: 进场 from scale(0)->scale(1) + 移动到底部(示例: 150px) */
    @keyframes containerEnter {
      0% {
        transform: translate(-50%, -50%) scale(0); opacity: 0;
      }
      50% {
        transform: translate(-50%, -50%) scale(1); opacity: 1;
      }
      100% {
        /* 最终移动到容器底部30px (示例: 150px) */
        transform: translate(-50%, calc(-50% + 150px)) scale(1);
        opacity: 1;
      }
    }
    @keyframes containerLeave {
      0% {
        /* 从底部位置开始合并回中心 */
        transform: translate(-50%, calc(-50% + 150px)) scale(1);
        opacity: 1;
      }
      50% {
        /* 回到中心 scale(1) */
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
    }

    /* 合并态大圆: fadeOut => 分裂, fadeIn => 合并 */
    @keyframes mergedFadeOut {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }
    @keyframes mergedFadeIn {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }

    /* 分裂态: 左胶囊 & 右圆, 在合并态消失后显示 */
    @keyframes leftPillEnter {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes rightCircleEnter {
      0%   { opacity: 0; }
      100% { opacity: 1; }
    }
    /* 离场: 先让左右都隐藏, 再出现合并态 */
    @keyframes leftPillLeave {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }
    @keyframes rightCircleLeave {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }

    /* 容器进场 */
    .two-part-btn-wrap.enter {
      animation: containerEnter 1.2s forwards ease-in-out;
    }
    /* 容器离场 */
    .two-part-btn-wrap.leave {
      animation: containerLeave 1.2s forwards ease-in-out;
    }

    /* 合并态(大圆)进场 -> 留在前半段, 然后 fadeOut */
    /* or 你也可先短暂停留, 再分裂 */
    .merged-circle.enter {
      animation: mergedFadeOut 0.5s 0.5s forwards ease-in-out;
      /* 0.5s 后开始 fadeOut, total 1.0s => 与 containerEnter 1.2s 配合 */
    }
    .merged-circle.leave {
      /* 当左右都离场后再出现 */
      animation: mergedFadeIn 0.5s 0.6s forwards ease-in-out;
    }

    /* 左胶囊、右圆 进场(分裂) */
    .left-pill.enter {
      animation: leftPillEnter 0.4s 1.0s forwards ease-in-out;
      /* 在 mergedFadeOut 差不多结束(1.0s) 后再出现 */
    }
    .right-circle.enter {
      animation: rightCircleEnter 0.4s 1.0s forwards ease-in-out;
    }

    /* 左胶囊、右圆 离场 */
    .left-pill.leave {
      animation: leftPillLeave 0.4s 0s forwards ease-in-out;
    }
    .right-circle.leave {
      animation: rightCircleLeave 0.4s 0s forwards ease-in-out;
    }
  </style>
</head>
<body>

<!-- 模拟头部导航 -->
<div class="header">
  <h1>Header Nav</h1>
  <div>Other nav items</div>
</div>

<!-- 模拟长页面: 上方空内容 -->
<div style="height: 600px; background: #fff;">
  <p style="padding:20px;">Scroll down to see the carousel container and splitting button...</p>
</div>

<!-- 轮播容器 -->
<div class="carousel-container" id="carouselContainer">
  <h2>Demo Carousel</h2>
  <div class="carousel">
    <p>Carousel Slides...</p>
  </div>

  <!-- 两部分按钮外容器 -->
  <div class="two-part-btn-wrap" id="twoPartBtn">
    <!-- 合并态大圆 -->
    <div class="merged-circle" id="mergedCircle">
      <span>合并态</span>
    </div>
    <!-- 分裂态：左胶囊 & 右圆，相隔一定距离 -->
    <div class="left-pill" id="leftPill">
      <div class="progress-bar"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
    <div class="right-circle" id="rightCircle">
      <div class="play-icon"></div>
    </div>
  </div>
</div>

<!-- 更多内容，拉长页面以便滚动 -->
<div style="height:1000px; background:#fafafa; padding:20px;">
  <h2>Page Content below ...</h2>
  <p>Keep scrolling...</p>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const carouselContainer = document.getElementById('carouselContainer');
  const twoPartBtn  = document.getElementById('twoPartBtn');
  const mergedCircle= document.getElementById('mergedCircle');
  const leftPill    = document.getElementById('leftPill');
  const rightCircle = document.getElementById('rightCircle');

  let isActive = false; // 是否已显示(分裂态)

  // 示例点击事件
  mergedCircle.addEventListener('click', (e)=>{
    e.stopPropagation();
    alert("点击了合并态大圆");
  });
  leftPill.addEventListener('click', (e)=>{
    e.stopPropagation();
    alert("点击了左胶囊");
  });
  rightCircle.addEventListener('click', (e)=>{
    e.stopPropagation();
    alert("点击了右播放圆");
  });

  // 监听滚动
  window.addEventListener('scroll', onScroll);
  function onScroll(){
    const rect = carouselContainer.getBoundingClientRect();
    const distance = rect.bottom - window.innerHeight;
    // 当轮播底部已滚上视口180px => show
    if(distance <= -180 && distance > -2000) {
      if(!isActive) showBtn();
    } else {
      if(isActive) hideBtn();
    }
  }

  function showBtn(){
    isActive = true;
    twoPartBtn.classList.add('active');
    twoPartBtn.classList.remove('leave');
    twoPartBtn.classList.add('enter');

    mergedCircle.classList.remove('leave');
    mergedCircle.classList.add('enter');

    leftPill.classList.remove('leave');
    leftPill.classList.add('enter');

    rightCircle.classList.remove('leave');
    rightCircle.classList.add('enter');
  }

  function hideBtn(){
    isActive = false;
    twoPartBtn.classList.remove('enter');
    twoPartBtn.classList.add('leave');

    mergedCircle.classList.remove('enter');
    mergedCircle.classList.add('leave');

    leftPill.classList.remove('enter');
    leftPill.classList.add('leave');

    rightCircle.classList.remove('enter');
    rightCircle.classList.add('leave');
  }
});
</script>
</body>
</html>
